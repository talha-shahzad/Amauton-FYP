(()=>{"use strict";const e=e=>e.indexOf("C $")>=0?"C $":e.indexOf("CDN$")>=0?"CDN$":e.indexOf("€")>=0?"€":e.indexOf("£")>=0?"£":e.indexOf("zł")>=0?"zł":e.indexOf("AU $")>=0?"AU $":e.indexOf("US $")>=0?"US $":e.indexOf("CHF")>=0?"CHF":e.indexOf("EUR")>=0?"EUR":e.indexOf("USD")>=0?"USD":"$";function t(e){const t=/(USD|EUR|€|\$|£|zł|CHF|R)\s?(\d{1,}(?:[.,]*\d{3})*(?:[.,]*\d*))|(\d{1,3}(?:[.,]*\d*)*(?:[.,]*\d*)?)\s?(USD|EUR|€|\$|£|zł|CHF|R)/g;let n,r,o,i=[];for(;null!==(o=t.exec(e));){let e=o[2]||o[3];e&&(e=e.replace(/[.](?=\d{3}\b)/g,""),e=e.replace(/[,](?=\d{3}\b)/g,""),e=e.replace(/,/g,"."),i.push(parseFloat(e)))}return i.length>0&&(n=i.reduce(((e,t)=>e<t?e:t)),r=i.reduce(((e,t)=>e>t?e:t))),{prices:i,minValue:n,maxValue:r}}const n=e=>{const n=[];let r,o;return e.length>0&&(e.forEach((e=>{t(e.textContent).prices.forEach((e=>n.push(e)))})),n.length>0&&(r=n.reduce(((e,t)=>e<t?e:t)),o=n.reduce(((e,t)=>e>t?e:t)))),{prices:n,minPrice:r,maxPrice:o}};function r(e){return 0===e.length||!e.trim()}function o(e,t,n){isNaN(+t?.[n])||(e[n]=+t[n])}function i(e){return encodeURIComponent(e.trim().replace(/"/g,"")).replace("/%2F/g","")}const a=(...e)=>{console.log("ext -",...e)},s=(...e)=>{console.log("ext - ERROR -",...e)},l=(e,t,n,r)=>{chrome.runtime.sendMessage({command:"pvv-ext-sendLog",type:e,data:t,addInfo:{message:n,url:r}})},c=(e,t,n,r)=>{l("error_address_parsing - "+e,t,n,r)},d=(e,t,n,r)=>{l("error_address_paste - "+e,t,n,r)},u=e=>{if("string"!=typeof e)return e;if(void 0!==window.DOMParser)return(new DOMParser).parseFromString(e,"text/html");const t=document.implementation.createHTMLDocument("");return t.body.innerHTML=e,t},m=(e,t,n=[])=>{for(const[r,o]of Object.entries(e))n.includes(r)?!t[r]&&o&&(t[r]=o):t[r]=o};const p=(e,t)=>{const n={command:"pvv-ext-setBuyerAddress",buyerAddress:e,useCrossBrowserAddressCopying:t};return new Promise(((e,t)=>{chrome.runtime.sendMessage(n,(n=>{n.success?e(n):t(n)}))}))},y=(e,t)=>{try{const n=new URL(t).searchParams.get(e);return n||""}catch(e){return""}},f=window.location.href,h={origin:window.location.origin,domain:(v=window.location.hostname,v.indexOf(".co.uk")>0?"co.uk":v.indexOf(".ca")>0?"ca":v.indexOf(".it")>0?"it":v.indexOf(".de")>0?"de":v.indexOf(".fr")>0?"fr":v.indexOf(".es")>0?"es":v.indexOf(".com.au")>0?"com.au":v.indexOf(".com.mx")>0?"com.mx":v.indexOf(".com.br")>0?"com.br":v.indexOf(".nl")>0?"nl":v.indexOf(".co.jp")>0?"co.jp":v.indexOf(".in")>0?"in":v.indexOf(".sg")>0?"sg":v.indexOf(".ae")>0?"ae":v.indexOf(".com.tr")>0?"com.tr":v.indexOf(".pl")>0?"pl":v.indexOf(".ie")>0?"ie":v.indexOf(".be")>0?"be":v.indexOf(".ch")>0?"ch":v.indexOf(".at")>0?"at":"com"),amazon:!1,amzSellercentral:!1,ebay:!1,searchList:!1,itemList:!1,buyerAddress:!1,buyerAddress_2018_05:!1,manageOrders:!1,amzDeals:!1,grabley:!1,walmart:!1,totalelement:!1,amzOrderPage:!1,aliexpress:!1,dirRLT:"rtl"===document.dir,language:(e=>e.indexOf(".sa/")>0?"ar":e.indexOf(".fr/")>0?"fr":e.indexOf(".de/")>0?"de":"en")(f),initHosts:function(){document.querySelector("#dealTitle")&&(h.amazon=!0,h.amzDeals=!0),(f.indexOf("sellercentral")>0||document.querySelector("#sc-logo-asset"))&&(h.amazon=!0,h.amzSellercentral=!0),(document.querySelector("#myo-order-details-buyer-address")||document.querySelector('div[data-test-id="shipping-section-buyer-address"]')||document.querySelector("#shipping-section-buyer-address"))&&(h.amazon=!0,h.buyerAddress=!0),document.querySelector('span[data-test-id="order-id-value"]')&&(h.amazon=!0,h.amzOrderPage=!0),(f.toLowerCase().includes("amazon")||document?.title.toLowerCase().includes("amazon"))&&(h.amazon=!0,document.querySelector(".s-result-item")&&(h.searchList=!0),(document.querySelector("#productTitle")||document.querySelector("#detail_bullets_id"))&&(h.itemList=!0),document.querySelector("#myo-order-details-buyer-address")&&(h.buyerAddress=!0)),(f.indexOf(".ebay.")>0||f.indexOf("/Development/amazon-ebay-order/ebay/")>0)&&(h.ebay=!0),f.indexOf("extension.grabley.net")>0&&(h.grabley=!0),f.indexOf("walmart.com")>0&&(h.walmart=!0),f.indexOf("totalelement.com")>0&&(h.totalelement=!0),f.indexOf(".aliexpress.")>0&&(h.aliexpress=!0)},showHosts:function(){for(let e in h)console.log("showHosts - "+e+": "+h[e])}};var v;Object.defineProperty(h,"initHosts",{enumerable:!1}),Object.defineProperty(h,"showHosts",{enumerable:!1}),h.initHosts();function g(e,t){return!!e.active||("mainSwitch"===t||"active"===t||"user_login"===t||"language"===t||"hideItemsWithVariation"===t||"showPrime"===t||"showAsin"===t||"showBuyBox"===t||"showBrand"===t||"showProductInformation"===t||"showCustomerReviewsFilter"===t||"hideAdvertisingBlocks"===t||"buttonSearchOnEbay"===t||"buttonSearchOnEbay_BuyItNow"===t||"buttonSearchOnEbay_ItemLocation_NorthAmerica"===t||"buttonSearchOnWalmart"===t||"getBSR"===t||"showMargin"===t||"amazonFee"===t||"ebay_only_FastAndFree"===t||"buttonSearchOnAmazon"===t||"ebay_button_DefaultFilters"===t||"phone"===t||"ebay_MessageToSeller"===t||"ebay_show_QuantityAvailable"===t||"ebay_show_Delivery"===t||"ebay_show_Returns"===t||"ebay_show_Brand"===t||"ebay_show_QuantityItemsSold"===t||"ebay_hide_ItemsByQuantity"===t||"ebay_hide_ItemsByQuantity_minQuantity"===t||"ebay_show_ItemSpecifics"===t||"walmartAddButtonSearchOnAmazon"===t||"walmartAddButtonSearchOnEbay"===t||"walmartAddButtonSearchOnEbay_BuyItNow"===t||"walmartAddButtonSearchOnEbay_ItemLocation_NorthAmerica"===t||"buyerAddress"===t||"showLog"===t||"ebayOptions"===t||"amz_showQuantityOnProductPage"===t)}const b={mainSwitch:!0,active:!1,language:"en",useCrossBrowserAddressCopying:!1,hidePrime:!1,hideSoldByAmazon:!1,hideItemsWithVariation:!1,onlyCurrentlyUnavailable:!1,hideAdvertisingBlocks:!1,buttonSearchOnWalmart:!0,buttonSearchOnEbay:!0,buttonSearchOnEbay_BuyItNow:!1,buttonSearchOnEbay_ItemLocation_NorthAmerica:!1,showAsin:!0,showBuyBox:!0,getBSR:!0,hideEmptyBSR:!1,maxValBSR:"",minValBSR:"",showBrand:!0,showProductInformation:!0,showCustomerReviewsFilter:!0,showPrime:!0,quickSearchOnEbay:!1,amz_showQuantityOnProductPage:!0,showMargin:!0,amazonFee:15,ebay_button_DefaultFilters:!0,hideDontSold:!1,buttonSearchOnAmazon:!0,ebay_only_FastAndFree:!1,phone:"",ebay_MessageToSeller:"",ebay_show_QuantityAvailable:!0,ebay_show_QuantityItemsSold:!0,ebay_show_Delivery:!0,ebay_show_Returns:!0,ebay_show_Brand:!0,ebay_hide_ItemsByQuantity:!1,ebay_hide_ItemsByQuantity_minQuantity:1,ebay_show_ItemSpecifics:!0,walmartAddButtonSearchOnAmazon:!0,walmartAddButtonSearchOnEbay:!0,walmartAddButtonSearchOnEbay_BuyItNow:!1,walmartAddButtonSearchOnEbay_ItemLocation_NorthAmerica:!1},S=(e,t)=>new Promise((n=>chrome.runtime.sendMessage({command:"pvv-ext-getCacheData",cacheType:t,cacheKey:e},(e=>{n(e)})))),x=(e,t,n)=>{chrome.runtime.sendMessage({command:"pvv-ext-setCacheData",cacheType:t,cacheKey:e,data:n})},w={newWithCapitalsLetters:["New","Nuevo","Neu","Neuf","Nowy","Nieuw","Nuovo","Nowe"],get new(){return[...this.newWithCapitalsLetters].map((e=>e.toLocaleLowerCase()))},ratings:[" ratings","&nbsp;Bewertungen","&nbsp;évaluations","Ocen: "],positiveOverLast12Months:["positive over last 12 months","positiv in den letzten 12&nbsp;Monaten","positiv über die gesamte Laufzeit","&nbsp;% positif(s) au cours des 12&nbsp;derniers mois","pozytywnych w ciągu ostatnich 12 miesięcy"]},q=(e,t)=>{let n=e;return t.forEach((e=>{n=n.replace(e,"")})),n},A=(e,n,r)=>{e.getQueryOfferListing=!0;const o=((e,n)=>{const r={sellersCount:0,moreSellersPossible:!1,fbaCount:0,fbmCount:0,amzCount:0,soldByAmazon:!1,prime:!1,totalQuantity:0,newConditionTotalQuantity:0,sellers:[]},o=u(e).querySelector("body"),i=o.querySelector("#aod-pinned-offer");if(i){const e=a(i);e&&r.sellers.push(e)}return o.querySelectorAll("#aod-offer-list #aod-offer").forEach((e=>{const t=a(e);t&&r.sellers.push(t)})),r.sellers.forEach((e=>{r.totalQuantity+=e.qty,"new"===e.condition.toLowerCase()&&(r.newConditionTotalQuantity+=e.qty),r.sellersCount++,"fba"===e.type?r.fbaCount++:r.fbmCount++,e.soldByAmazon&&(r.soldByAmazon=!0)})),r.prime=!!(n.prime||r.fbaCount>0||r.soldByAmazon),r.moreSellersPossible=r.sellersCount>9,r;function a(e){if(!e)return null;const n=e.querySelector("#aod-offer-soldBy");if(!n)return null;const r={condition:"",conditionFull:"",price:0,shipsFrom:"",soldBy:{name:"",linkNode:"",ratingNode:null},customerService:{name:"",linkNode:""},qty:0,soldByAmazon:!1,type:"fbm"},o=n.querySelector(".a-col-right");if(o){const t=o.querySelector("a");t?(r.soldBy.name=t.innerText.trim(),r.soldBy.linkNode=t.outerHTML):r.soldBy.name=o.innerText.trim();const n=e.querySelector("#aod-offer-seller-rating");n&&(r.soldBy.ratingNode=n.outerHTML)}r.qty=e.querySelectorAll('[id^="aod-offer-qty-component-"] .aod-qty-option').length,r.qty||(r.qty=1);const i=e.querySelector("#aod-offer-heading");i&&(r.conditionFull=i.innerText.trim(),r.condition=w.new.includes(r.conditionFull.toLocaleLowerCase())?"New":"Used");const a=e.querySelector('[id^="aod-price-"] .aok-offscreen');if(a&&(r.price=t(a.innerText).minValue),!r.price){const n=e.querySelector(".a-price .a-offscreen");n&&(r.price=t(n.innerText).minValue)}const s=e.querySelector("#aod-offer-shipsFrom .a-col-right");s&&(r.shipsFrom=s.innerText.trim());const l=e.querySelector("#aod-offer-customerServiceIdentifier .a-col-right");if(l){const e=l.querySelector("a");e?(r.customerService.name=e.innerText.trim(),r.customerService.linkNode=e.outerHTML):r.customerService.name=l.innerText.trim()}return r.shipsFrom&&r.shipsFrom.toLocaleLowerCase().includes("amazon")&&(r.type="fba"),r.soldBy.name&&r.soldBy.name.toLocaleLowerCase().includes("amazon")&&(r.soldByAmazon=!0),r}})(n,e);m(o,e),r&&r()};function L(e){const t={source_BSR:"-",value_BSR_string:" ",value_BSR:0,category_BSR:"",otherCategoriesBSR:[],buyBox:"-",salersNew:void 0,itemWithVariation:!1,brand:void 0,minPrice:void 0,maxPrice:void 0,partNumber:void 0,itemModelNumber:void 0,upc:void 0,sellersInfo:[]},r=u(e).querySelector("body"),o=r.querySelectorAll("#twister"),i=r.querySelectorAll("#twister-plus-inline-twister");t.itemWithVariation=o.length+i.length>0,t.buyBox=r.querySelectorAll("#add-to-cart-button").length>0,r.querySelector(".primeUpsellIcon")&&(t.prime=!0);const a=r.querySelectorAll(".prodDetSectionEntry");return function(e,t){let n=[];0===n.length&&(n=t.querySelectorAll("#prodDetails [href*='/gp/bestsellers/']"));0===n.length&&(n=t.querySelectorAll("#productDetails_detailBullets_sections1 [href*='/gp/bestsellers/']"));0===n.length&&(n=t.querySelectorAll("#detailBulletsWrapper_feature_div [href*='/gp/bestsellers/']"));0===n.length&&(n=t.querySelectorAll("#productDetails_detailBullets_sections1 [href*='/gp/bestsellers/']"));0===n.length&&(n=t.querySelectorAll("#productDetails_detailBullets_sections [href*='/gp/bestsellers/']"));0===n.length&&(n=t.querySelectorAll("#productDetailsTable [href*='/gp/bestsellers/']"));0===n.length&&(n=t.querySelectorAll("#productDetails_db_sections [href*='/gp/bestsellers/']"));0===n.length&&(n=t.querySelectorAll("#detailBullets_feature_div [href*='/gp/bestsellers/']"));let{text_BSR:r,otherCategoriesBSR:o}=i(n);r||(r=a(t.querySelector("#SalesRank")?.textContent));r||(r=t.querySelector("#SalesRank .value")?.textContent,r=a(r,0));if(r){const t=75;e.source_BSR=r,e.otherCategoriesBSR=o;let n="#"===r.charAt(0)?1:0,i=r.indexOf(" ");e.value_BSR_string=r.substring(n,i).trim(),e.value_BSR=parseInt(e.value_BSR_string.split(",").join("").split(".").join("")),e.category_BSR=r.substring(i).trim(),e.category_BSR.length>t&&(e.category_BSR=e.category_BSR.substr(0,t-3)+"...")}function i(e){const t={text_BSR:void 0,otherCategoriesBSR:[]};return e&&0!==e.length?(t.text_BSR=a(e[0]?.parentElement?.textContent),e.forEach(((e,n)=>{if(n>0){const n=e?.parentElement?.textContent;n&&t.otherCategoriesBSR.push(n)}})),t):t}function a(e,t){if(!e)return;const n=e.toLowerCase().replace(/\{.*\}/g,"").trim();void 0===t&&(t=Math.max(n.search(/\d/),0));const r=o(n,"(see top","(visualizza","(voir","(siehe","(ver");return r>0?n.substring(t,r-1).trim():void 0;function o(e,...n){const r=e.length;let o=r;for(let i=0;i<n.length;i++){let a=e.indexOf(n[i],t+1);a=-1===a?r:a,o=Math.min(a,o)}return o}}}(t,r),function(e,t,n){const r=["Brand","Marke","Marque","Marka","Marca","Marchio","Merk","Varumärke","Üretici","الشركة المصنعة","العلامة التجارية","ブランド"];if(e.brand=C(n,...r),!e.brand){const n=t.querySelector(".po-brand");r.forEach((t=>{n&&n.textContent.includes(t)&&(e.brand=n.textContent.trim().slice(t.length).trim())}))}if(!e.brand){const n="Brand:",r=t.querySelector("#bylineInfo");r&&r.textContent.includes(n)&&(e.brand=r.textContent.trim().slice(n.length).trim())}}(t,r,a),function(e,t){let r={minPrice:void 0,maxPrice:void 0};const o=t.querySelectorAll("#apex_desktop .aok-offscreen");if(o.length>0)r=n([o[0]]);else{const e=t.querySelectorAll("#apex_desktop .apexPriceToPay");e.length>0&&(r=n(e))}e.minPrice=r.minPrice,e.maxPrice=r.maxPrice}(t,r),function(e,t,n){const r=["Part Number","Artikelnummer","Référence","Número da Peça","Parça Numarası","Onderdeelnummer","Número de modelo del producto","Modello","Codice articolo","部品番号"];e.partNumber=C(n,...r)}(t,0,a),function(e,t,n){const r=["Item model number","Modellnummer","Número do modelo","Modelnummer item","Identificador de producto del fabricante","Nazwa modelu","Numéro de modèle","Numero modello articolo","製品型番"];e.itemModelNumber=C(n,...r)}(t,0,a),function(e,t,n){const r=["UPC"];e.upc=C(n,...r)}(t,0,a),t}function C(e,...t){const n=function(e,...t){let n=null;return e.forEach((e=>{t.forEach((t=>{const r=t.toLowerCase();e.textContent.trim().toLowerCase()===r&&(n=e.parentNode)}))})),n}(e,...t);if(n)return n.querySelector(".prodDetAttrValue")?.textContent.trim()}const E=(e,t)=>{const n=L(t);m(n,e,["minPrice","maxPrice"]),x(e.asin,"AdditionalInformation",n)};function _(e){return t(e,"Canada")||t(e,"Kanada")?"CA":!0===function(e){const t=["APO","FPO","DPO"],n=["AA","AE","AP"];let r=!1,o=!1;for(let i of e)t.includes(i.toUpperCase())&&(r=!0),n.includes(i.toUpperCase())&&(o=!0);if(!0===r&&!0===o)return!0;return!1}(e)?"AA":"US";function t(e,t,n=3){const r=t.trim().replace(/\./g,"").replace(/,/g,"").toUpperCase();let o=e.length-1;for(;o>n;){if(e[o].trim().replace(/\./g,"").replace(/,/g,"").toUpperCase()===r)return!0;o--}return!1}}function B(e){if(!e)return"";const t=e.indexOf("ext.");return-1!==t?e.slice(0,t).trim():e}function T(e,t){const n=(e=>{let t=[];return e.querySelectorAll("span").forEach((e=>{const n=e.textContent.trim();n&&t.push(n)})),t.length<4&&(new Array(...e.children).forEach((e=>e.textContent=",")),t=e.textContent.split(",")),t=t.map((e=>e.trim().replace(/,/g,""))).filter((e=>e.length>0)),t})(e);return t&&n.push("Phone:"+t),O(n,e.textContent,e.innerHTML)}const P=(e,t)=>{let n=[...e.replace(/"/g,"").split(t)];return n=n.map((e=>e.trim())).filter((e=>e.length>0)),n=(e=>{const t=[...e],n=I(_(e));let r=t.length-1;for(;r>1;){const e=t[r].trim();if(e.includes(" ")){const o=e.split(" ");for(let i=0;i<o.length;i++){const a=n.getStateCode(o[i]);if(a){const n=e.lastIndexOf(o[i]),s=e.slice(0,n),l=e.slice(n+o[i].length);return t.splice(r,1,s,a,l),t}}}else if(n.getStateCode(e))return t;r--}return t})(n),n=n.map((e=>e.trim().replace(/,/g,""))).filter((e=>e.length>0)),n};function N(e){let t=[];if(e.includes("Address Type:"))try{t=(e=>{const t=e.replace(/"/g,"").split("Address Type:");if(2!==t.length)throw new Error("address from text - splitByAddressType.length !== 2");const n=[...t[0].split("\n")],r=n.pop().split(", ");if(2!==r.length)throw new Error("address from text - arrCityAndStateZip.length !== 2");n.push(r[0]);const o=r[1].search(" ");if(-1===o)throw new Error("address from text - arrCityAndStateZip - can't search separator");const i=r[1].slice(0,o).trim(),a=r[1].slice(o).trim();if(n.push(i),n.push(a),t[1].includes("Phone:")){const e=t[1].slice(t[1].search("Phone:")).trim();e&&n.push(e)}return n})(e)}catch(e){}if(t.length<4)try{t=P(e,"\t")}catch(e){}if(t.length<4)try{t=P(e,", ")}catch(e){}if(t.length<4)try{t=P(e,"\n")}catch(e){}if(t.length<4)try{t=P(e,";")}catch(e){}return O(t,e)}function O(e,t,n=""){if(e.length<4)throw new Error("arrAddress.length <= 4 (minimum allowed array length)");const r=_(e),o=((e,t)=>{const n={state:"",stateCodeIndex:-1},r=I(t);let o=e.length-1;for(;o>0;){const t=r.getStateCode(e[o]);if(t)return n.state=t,n.stateCodeIndex=o,n;o--}return n})(e,r),i=o.stateCodeIndex,a=o.state;if(!a||-1===i)throw new Error("Can't find the state in arrAddress!");if(i===e.length-1)throw new Error("Can't find the zip-code in arrAddress!");if(i<2)throw new Error("Can't find name or city in arrAddress!");const s=(e=>{let t;return t=n(e,"Phone:"),t||(t=n(e,"Phone number:"),t||(t=n(e,"+1 "),t?"+1 "+t:(t=e.find((e=>e.includes("ext."))),t||"")));function n(e,t){let n;const r=e.find((e=>e.includes(t)));return r&&(n=r.slice(r.indexOf(t)+t.length).trim()),n}})(e),l=B(s),c=(e=>{const t=e[0].split(" ").filter((e=>e.trim().length>0));let n=t.slice(0,t.length-1).join(" "),r=t[t.length-1];return 0===n.length&&0!==r.length&&(n=r,r="."),{fullName:e[0],firstName:n,lastName:r}})(e),d=((e,t)=>{const n=e.filter(((e,n)=>n>0&&n<t-1)),r=n[0]?n[0]:"",o=n.length>1?n.slice(1).join(" "):"";return{addressParts:n,address1:r,address2:o}})(e,i),u={arrAddress:e,text:t,innerHTML:n?`${n} ${s?"<div> phone: "+s+"</div>":""}`:"",country:r,fullName:c.fullName,firstName:c.firstName,lastName:c.lastName,addressParts:d.addressParts,address1:d.address1,address2:d.address2,city:e[i-1],state:a,zip:e[i+1],phoneFull:s,phone:l};return u.innerHTML||(u.innerHTML=function(e){let t="<span style='color: green;'>~ loaded from clipboard ~</span><br>";t+=`<span>${e.fullName}</span><br>`,e.addressParts.forEach((e=>{t+=`<span>${e}</span><br>`})),t+=`<span>${e.city}</span>, <span>${e.state}</span> <span>${e.zip}</span>`,e.phoneFull&&(t+=`<br><span>Phone: ${e.phoneFull}</span>`);return t}(u)),u}function I(e){class t{constructor(e,t,n=[],r={}){this.stateCode=e,this.stateName=t,this.additionalNames=n,this.marketplaceValue=r,this.defaultMarketplaceValue=e.toUpperCase()}getMarketplaceValue(e,t){const n=this.marketplaceValue[e];return n||(t?this.stateName:this.defaultMarketplaceValue)}}const n=function(e){return"CA"===e?[new t("AB","Alberta",[],{amazon:"Alberta"}),new t("BC","British Columbia",["Britanya Kolombiyası"],{amazon:"British Columbia"}),new t("MB","Manitoba",[],{amazon:"Manitoba"}),new t("NB","New Brunswick",["Nouveau-Brunswick","Nouveau - Brunswick","newbrunswick"],{amazon:"New Brunswick"}),new t("NL","Newfoundland and Labrador",["Newfoundland"],{amazon:"Newfoundland"}),new t("NS","Nova Scotia",[],{amazon:"Nova Scotia"}),new t("NU","Nunavut",[],{amazon:"Nunavut"}),new t("NT","Northwest Territories",[],{amazon:"Northwest Territories"}),new t("ON","Ontario",[],{amazon:"Ontario"}),new t("PE","Prince Edward Island",[],{amazon:"Prince Edward Island"}),new t("QC","Quebec",["Québec"],{amazon:"Quebec"}),new t("SK","Saskatchewan",[],{amazon:"Saskatchewan"}),new t("YT","Yukon",[],{amazon:"Yukon"})]:[new t("AA","Armed Forces (AA)",[],{aliexpress:"Other"}),new t("AE","Armed Forces (AE)",[],{aliexpress:"Other"}),new t("AP","Armed Forces (AP)",[],{aliexpress:"Other"}),new t("AL","Alabama"),new t("AK","Alaska"),new t("AZ","Arizona"),new t("AR","Arkansas"),new t("CA","California"),new t("CO","Colorado"),new t("CT","Connecticut"),new t("DE","Delaware"),new t("DC","District Of Columbia"),new t("FL","Florida"),new t("GA","Georgia"),new t("HI","Hawaii"),new t("ID","Idaho"),new t("IL","Illinois"),new t("IN","Indiana"),new t("IA","Iowa"),new t("KS","Kansas"),new t("KY","Kentucky"),new t("LA","Louisiana"),new t("ME","Maine"),new t("MD","Maryland"),new t("MA","Massachusetts"),new t("MI","Michigan"),new t("MN","Minnesota"),new t("MS","Mississippi"),new t("MO","Missouri"),new t("MT","Montana"),new t("NE","Nebraska"),new t("NV","Nevada"),new t("NH","New Hampshire"),new t("NJ","New Jersey"),new t("NM","New Mexico"),new t("NY","New York"),new t("NC","North Carolina"),new t("ND","North Dakota"),new t("OH","Ohio"),new t("OK","Oklahoma"),new t("OR","Oregon"),new t("PA","Pennsylvania"),new t("RI","Rhode Island"),new t("SC","South Carolina"),new t("SD","South Dakota"),new t("TN","Tennessee"),new t("TX","Texas"),new t("UT","Utah"),new t("VT","Vermont"),new t("VA","Virginia"),new t("WA","Washington"),new t("WV","West Virginia"),new t("WI","Wisconsin"),new t("WY","Wyoming"),new t("PR","Puerto Rico"),new t("VI","Virgin Islands"),new t("MP","Northern Mariana Islands"),new t("GU","Guam"),new t("AS","American Samoa"),new t("PW","Palau")]}(e),r=(e,t,r=!1)=>{const o=n.find((t=>t.stateCode.toUpperCase()===e.toUpperCase()));if(o)return o.getMarketplaceValue(t,r)},o=e=>{if("string"!=typeof e)return;const t=e.trim().replace(/\./g,"").replace(/,/g,"").toUpperCase();return n.find((e=>{if(e.stateCode.toUpperCase()===t)return!0;if(e.stateName.toUpperCase()===t)return!0;return!!e.additionalNames.find((e=>e.toUpperCase()===t))}))};return{country:e,states:n,findStateByName:o,getStateCode:e=>{const t=o(e);if(t)return t.stateCode.toUpperCase()},getEbayStateValue:e=>r(e,"ebay"),getAmazonStateValue:e=>r(e,"amazon"),getAliexpressStateValue:e=>r(e,"aliexpress",!0)}}class M extends Error{constructor(e){super(e),this.name="AuthorizationError"}}function k(e){let t="https://extension.grabley.net/en/";return e&&("ru"===e?t="https://extension.grabley.net/":"ua"===e&&(t="https://extension.grabley.net/uk/")),t}function R(e){let t=k(e)+"extension-en/#price";return e&&("ru"===e?t=k(e)+"#price":"ua"===e&&(t=k(e)+"extension-ua/#price")),t}const $=e=>{const t=document.createElement("div");if(t.style="display: none; margin-bottom: 5px;",!e.active){let n="en"===e.language?"Available in the PRO version! Buy Now!":"Достпуно в PRO-версии! Купить сейчас!",r=R(e.language);e.user_login||(n="en"===e.language?"Please login to Grabley":"Авторизируйтесь в Grabley",r=function(e){let t=k(e)+"profile-en";return e&&("ru"===e?t=k(e)+"profile":"ua"===e&&(t=k(e)+"profile-ua")),t}(e.language)),t.innerHTML=`<a href=${r} target="_blank" style="font-size: 14px; color: blue;">${n}</a>`}return t};function z(e,t){if(!e||!t)return;const n=t.parentNode;t.nextSibling&&n?n.insertBefore(e,t.nextSibling):n&&n.appendChild(e)}const H=new Event("click",{bubbles:!0}),D=new Event("change",{bubbles:!0}),F=new Event("input",{bubbles:!0}),U=e=>{e.dispatchEvent(D)},V=(e,t)=>{e.dispatchEvent(new CustomEvent("updateDataEvent",{detail:t}))},Q=(e,t=100,n=2e3,r="",o=document)=>{let i,a=0;const s=new Promise((n=>{i=setInterval((()=>{a++,r&&console.log(`taskPromise - ${r} - iteration: ${a}`);const t=o.querySelector(e);t&&(clearInterval(i),n(t))}),t)})),l=new Promise((e=>{setTimeout((()=>{clearInterval(i),e(null)}),n)}));return Promise.race([s,l])},W=async(e,t,n,r=100,o=2e3,i)=>(e.dispatchEvent(t),await Q(n,r,o,i)),j=e=>new Promise((t=>setTimeout(t,e))),G=(e,t)=>{if(!e)return!1;const n=e.textContent.toLowerCase();return RegExp(t.toLowerCase()).test(n)},K=(e,t)=>[].filter.call(e,(e=>G(e,t)));function X(e,t,n=5e3){o();const r=document.createElement("span");function o(){document.querySelectorAll(".pvv-ext-CopyError").forEach((e=>e.remove()))}r.setAttribute("style","color: red; font-size: 12pt; font-weight: bolder"),r.textContent=t,r.className="pvv-ext-CopyError",e.appendChild(r),setTimeout(o,n)}function Y(e,t=" * copied",n=2e3){const r=document.createElement("span");r.setAttribute("style","color: green; font-size: 12pt;"),r.textContent=t,r.className="pvv-ext-CopySuccess",e.appendChild(r),setTimeout((()=>document.querySelectorAll(".pvv-ext-CopySuccess").forEach((e=>e.remove()))),n)}function Z(e,t,n){console.log("loadAddressFromClipboard"),navigator.clipboard.readText().then((async r=>{if(0===r.length)return console.log("Clipboard contains no text!"),void X(n,"Error - Clipboard contains no text!");if(r.length>1e3)return console.log("The text on the clipboard is too long!"),void X(n,"Error - Clipboard text is too long!");if(r.length<20)return console.log("The text on the clipboard is too short!"),void X(n,"Error - Clipboard text is too short!");if(r.includes("https://"))return console.log('The text on the clipboard includes link "https://"!'),void X(n,"Error - Clipboard text includes link!");let o;try{o=N(r)}catch(e){console.log(e);const t=`${e.name}: ${e.message}     Stack: ${e.stack}`;return c("text from clipboard",r,t,document.location.href),s("Can't parse buyer's address from text"),void X(n,"Error - Can't parse address from clipboard!")}console.log("new buyerAddress",o),await p(o,!1),e.updateBuyerAddress=!0,t()})).catch((e=>{s("Error reading address from clipboard. "+e),X(n,"Error reading address from clipboard!")}))}function J(e="green",t,n=1500){document.querySelectorAll(".ext-popup-wrap").forEach((e=>e.remove()));let r="rgb(10, 100, 50)",o="rgb(56, 178, 172, 0.9)",i="rgb(56, 178, 172)";"blue"===e?(r="rgb(10, 50, 100)",o="rgb(30, 66, 159, 0.9)",i="rgb(30, 66, 159)"):"grey"===e&&(r="rgb(41, 51, 65)",o="rgb(229, 230, 231, 0.9)",i="rgb(180, 200, 200)");const a=document.createElement("div");a.classList.add("ext-popup-wrap"),a.innerHTML=`<div class="ext-popup">\n          <div class="ext-popup-container">${t}</div>\n        </div>`,document.body.appendChild(a);const s=document.querySelector(".ext-popup");s?.setAttribute("style","z-index: 1000; position: fixed; top: 16px; left: 40%; transition: opacity 400ms ease-in-out;");document.querySelector(".ext-popup-container")?.setAttribute("style",`\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        width: 220px;\n        min-height: 24px;\n        font-size: 14px;\n        color: ${r};\n        background-color: ${o};\n        border: 2px;\n        border-style: solid;\n        border-radius: 3px;\n        border-color: ${i};\n      `),setTimeout((()=>{s.style.opacity=0}),n)}function ee(e,t){e?function(e){J("green",e)}("ON - "+t):function(e){J("grey",e)}("OFF - "+t)}function te(...e){b.showLog&&a(...e)}function ne(...e){b.showLog&&te(...e,(new Date).toLocaleTimeString())}const re=chrome.runtime.getURL("img/sort-arrows.svg"),oe=chrome.runtime.getURL("img/sort-arrows-up.svg"),ie=chrome.runtime.getURL("img/sort-arrows-down.svg");function ae(e,t){const n=e.title.length>71?e.title.substr(0,71)+"...":e.title,r="pvv-ext-sellers-table-window";ce(r),t&&t.classList.add("pvv-ext-active-item");const o=document.createElement("div");o.className=r,o.innerHTML=`<div id="${r}-conteiner" class="pvv-ext-modal-window-conteiner">\n                                <div id="${r}-header" class="pvv-ext-modal-window-header">\n                                    Sellers and Qty\n                                    <button id="${r}-close-btn" class="pvv-ext-modal-window-header-close-btn"> × </button>\n                                </div>\n                                <div id="${r}-content" class="pvv-ext-modal-window-content">\n                                </div>\n                            </div>`,document.body.append(o);const i=e.totalQuantity===e.newConditionTotalQuantity?"":` / new: ${e.newConditionTotalQuantity}`,a=`FBA ${e.fbaCount}${e.moreSellersPossible?"+":""}`,s=`FBM ${e.fbmCount}${e.moreSellersPossible?"+":""}`,l=`<div style="margin-bottom: 10px;">\n            <div style="text-align: center;">${e.asin} - ${n}</div>\n            <div style="margin-top: 10px; height: 24px; display: flex; align-items: center; justify-content: space-between;">\n                <span style="font-weight: bold;">\n                    Total quantity: ${e.totalQuantity} ${i} \n                </span>\n                <span style="width: 224px; display: flex; align-items: center; justify-content: space-between;">\n                    <span style="margin-right: 5px;">Filters:</span>\n                    <button class="pvv-ext-filters-btn" data-filter-name="new">\n                        New\n                    </button>\n                    <button class="pvv-ext-filters-btn" data-filter-name="fba">\n                        ${a}\n                    </button>\n                    <button class="pvv-ext-filters-btn" data-filter-name="fbm">\n                        ${s}\n                    </button>\n                </span>\n            </div>\n        </div>`+function(){const e=e=>`<div style="display: flex; align-items: center; cursor: pointer;">\n            <span>${e}</span>\n            <img class="sort-arrows" src=${re} style="height: 10px; margin-left: 3px;">\n        </div>`,t=`<tr>\n            <th data-sort-type="string" style="width: 110px;">\n                Seller\n            </th>\n            <th data-sort-type="string" style="width: 60px;">\n                ${e("Type")}\n            </th>\n            <th data-sort-type="string" style="width: 60px;">\n                ${e("Cond")}\n            </th>\n            <th data-sort-type="number" style="width: 65px;">\n                ${e("Price")}\n            </th>\n            <th data-sort-type="number" style="width: 60px;">\n                ${e("Qty")}\n            </th>\n            <th style="width: 130px;">\n                Rating\n            </th>\n            <th>\n                Ships from\n            </th>\n        </tr>\n        <tr></tr>`;return`<table id="pvv-ext-table-sellers">\n        <thead>\n            ${t}\n        </thead>\n        <tbody>\n        </tbody>\n    </table>`}();!function(e,t,n){const r=e.querySelector(`#${t}-conteiner`),o=e.querySelector(`#${t}-header`),i=e.querySelector(`#${t}-close-btn`),a=e.querySelector(`#${t}-content`);if(!(r&&o&&i&&a))return void console.log("modal - Can't find keys elements");a.innerHTML=n;const s=document.documentElement.clientWidth,l=document.documentElement.clientHeight,c=r.clientWidth,d=r.clientHeight;let u=0,m=0,p=0,y=0;function f(e){e.preventDefault(),p=e.clientX,y=e.clientY,document.addEventListener("mousemove",v),document.addEventListener("mouseup",h)}function h(){document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",h),document.removeEventListener("keydown",g)}function v(e){e.preventDefault(),u=p-e.clientX,m=y-e.clientY,p=e.clientX,y=e.clientY;let t=r.offsetLeft-u,n=r.offsetTop-m;t<c/2&&(t=c/2),t>s-c/2&&(t=s-c/2),n<0&&(n=0),n>l-d&&(n=l-d),r.style.top=n+"px",r.style.left=t+"px"}function g(e){"Escape"===e.code&&b()}function b(){h(),ce(t)}o.addEventListener("mousedown",f),i.addEventListener("click",b),document.addEventListener("keydown",g)}(o,r,l);const c=e.sellers,d={new:!1,fba:!1,fbm:!1,change:function(e){this[e]=!this[e],"fba"===e&&this.fba&&(this.fbm=!1),"fbm"===e&&this.fbm&&(this.fba=!1)}},u=document.querySelector("#pvv-ext-table-sellers");!function(e,t,n,r){if(!e)return;e.addEventListener("click",i);const o=document.querySelectorAll(".pvv-ext-filters-btn");function i(t){if(!e)return;let n;const o=e.querySelectorAll("th");if("TH"===t.target.tagName)n=t.target;else for(const e of o)if(e.contains(t.target)){n=e;break}if(!n)return;const i=n.dataset.sortType;if(!i)return;const c=a(n.dataset.sortDirection);r.change(n.cellIndex,i,c),l(n.cellIndex,i,c);for(const e of o)e.dataset.sortDirection="",s(e);n.dataset.sortDirection=c,s(n,c)}function a(e){return"asc"===e?"desc":"asc"}function s(e,t){const n=e.querySelector(".sort-arrows");n&&(n.src=t?"asc"===t?oe:ie:re)}function l(t,n,r="asc"){if(!n)return;let o=e?.querySelector("tbody");if(!o)return void console.log("can't find table");let i,a=Array.from(o.rows);switch(n){case"number":i=function(e,n){return"asc"===r?e.cells[t].innerHTML-n.cells[t].innerHTML:n.cells[t].innerHTML-e.cells[t].innerHTML};break;case"string":i=function(e,n){return"asc"===r?e.cells[t].innerHTML>n.cells[t].innerHTML?1:-1:n.cells[t].innerHTML>e.cells[t].innerHTML?1:-1}}a.sort(i),o.append(...a)}o.forEach((i=>{i.addEventListener("click",(i=>{const a=i.target.dataset.filterName;void 0!==n[a]&&(n.change(a),o.forEach((e=>{n[e.dataset.filterName]?e.classList.add("pvv-ext-filters-btn-pressed"):e.classList.remove("pvv-ext-filters-btn-pressed")})),le(e,se(t,n)),l(r.cellIndex,r.type,r.direction))}))}))}(u,c,d,{cellIndex:"",type:"",direction:"",change:function(e,t,n){this.cellIndex=e,this.type=t,this.direction=n}}),le(u,se(c,d))}function se(e,t){let n=[...e];return t.new&&(n=n.filter((e=>"new"===e.condition.toLowerCase()))),t.fba&&(n=n.filter((e=>"fba"===e.type))),t.fbm&&(n=n.filter((e=>"fbm"===e.type))),n}function le(e,t){if(!e)return;let n="";t.forEach((e=>{const t=e.soldBy.linkNode?e.soldBy.linkNode:e.soldBy.name;let r=e.soldBy.ratingNode?e.soldBy.ratingNode:"";r=q(r,w.ratings),r=q(r,w.positiveOverLast12Months),n+=`<tr class="a-size-base">\n            <td>${t}</td>\n            <td style="height: 38px;" class="a-size-small">${e.type.toLocaleUpperCase()}</td>\n            <td class="a-size-small">${e.condition}</td>\n            <td style="text-align: center;">${e.price}</td>\n            <td style="text-align: center;">${e.qty}</td>\n            <td class="a-size-small">${r}</td>\n            <td class="a-size-small">${e.shipsFrom}</td>\n        </tr>`})),e.tBodies[0].innerHTML=n}function ce(e){document.querySelectorAll(`.${e}`).forEach((e=>e.remove())),document.querySelectorAll(".pvv-ext-active-item").forEach((e=>e.classList.remove("pvv-ext-active-item")))}const de=chrome.runtime.getURL("img/ebay.png"),ue=chrome.runtime.getURL("img/walmart.png"),me=chrome.runtime.getURL("img/icon-48.png"),pe=chrome.runtime.getURL("img/copy-icon.svg"),ye=chrome.runtime.getURL("img/icon-ok.svg"),fe=chrome.runtime.getURL("img/icon-error.svg"),he=chrome.runtime.getURL("img/icon-48.png"),ve="pvv-ext-FullBSR";let ge,be,Se=!0;const xe=()=>{const e={search:!1,product:!1,bestsellers:!1,addressSelect:!1};return document.location.href.includes("s?k=")||document.querySelector(".s-result-item")?e.search=!0:document.location.href.includes("/dp/")||document.querySelector("#productTitle")||document.querySelector("#detail_bullets_id")?e.product=!0:document.querySelector("#zg_banner")&&document.querySelector("#gridItemRoot")?e.bestsellers=!0:(document.querySelector("#address-ui-widgets-enterAddressLine1")||document.querySelector("#shipaddress"))&&(e.addressSelect=!0),e};let we=xe();const qe=[],Ae=e=>{qe.push(e)},Le=e=>qe.find((t=>t.asin===e)),Ce=()=>qe,Ee=({asin:e,title:t,href:n,qid:r="",prime:o=!1,currentlyUnavailable:i=!1,element:a=null,itemWithVariation:s=!1,sendQueryOfferListing:l=!1,getOfferListingInformation:c=!1,sendQueryAdditionalInformation:d=!1,getQueryOfferListing:u=!1,source_BSR:m="",brand:p,minPrice:y,maxPrice:f,totalQuantity:h,customerRatings:v})=>{const g={asin:e,title:t,href:n,qid:r,prime:o,currentlyUnavailable:i,element:a,itemWithVariation:s,sendQueryOfferListing:l,getOfferListingInformation:c,sendQueryAdditionalInformation:d,getQueryOfferListing:u,source_BSR:m,brand:p,errorFetchAdditionalInformation:!1,errorFetchOfferListingInformation:!1,minPrice:y,maxPrice:f,totalQuantity:h,customerRatings:v};return(e=>{e.hrefOfferListing="/gp/offer-listing/"+e.asin,e.hrefOfferListingWithFilters=e.hrefOfferListing+"/ref=olp_f_primeEligible?ie=UTF8&f_new=true&f_primeEligible=true",e.hrefOfferListingInformation=`/gp/product/ajax/ref=dp_aod_ALL_mbc?asin=${e.asin}&m=&qid=${e.qid}&smid=&sourcecustomerorglistid=&sourcecustomerorglistitemid=&sr=&pc=dp&experienceId=aodAjaxMain`})(g),g},_e=e=>{if(!e)return;let t=e.match(/\/dp\/([A-Z0-9]{10})\//)||[];return void 0!==t[1]?t[1].trim():(t=e.match(/%2Fdp%2F([A-Z0-9]{10})/)||[],void 0!==t[1]?t[1].trim():(t=e.match(/(?:[/dp/]|$)([A-Z0-9]{10})\//)||[],void 0!==t[1]?t[1].trim():void 0))},Be=e=>{let t="";const n=/[\?&]qid=(\d+)/.exec(e);return n&&(t=n[1]),t||""},Te=(e="")=>{let t="";const n=document.querySelector("[name=qid]");return n&&(t=n.value.trim()),t||(t=Be(e)),t||(t=y("qid",e)),t||(t=Be(document.URL)),t||(t=y("qid",document.URL)),t},Pe=e=>{let t,r,o,i,a,s,l,c="";if(we.search){const t=e.querySelector("h2 > a.a-link-normal");if(t)i=t.parentElement.innerText.trim(),r=t.getAttribute("href");else{let t=e.querySelector("a.s-access-detail-page");t&&(i=t.getAttribute("title"),r=t.getAttribute("href"))}}if(we.bestsellers){const t=e.querySelector("a.a-link-normal > span > div");if(t&&(i=t.innerText.trim(),r=t.parentElement.parentElement.getAttribute("href")),!r){const t=e.querySelector(".p13n-sc-uncoverable-faceout");if(t){o=t.id;const e=t.querySelector("span");e&&(i=e.innerText.trim())}}}o||(o=e.getAttribute("data-asin")),!o&&r&&(o=_e(r)),!r&&o&&(r=(e=>`${document.location.origin}/dp/${e}`)(o)),o&&i&&r||(t=`amz getMainData - Can't get item data from ${e}`),c=Te(r);const d=e.querySelectorAll('.a-price[data-a-color="base"] .a-offscreen'),u=n(d);a=u.minPrice,s=u.maxPrice;let m=e.querySelector('[data-csa-c-content-id="alf-customer-ratings-count-component"]');return m||(m=e.querySelector('[href*="#customerReviews"]')),m&&(l=+m.textContent.replace(",","").replace(".","")),{error:t,href:r,asin:o,title:i,qid:c,minPrice:a,maxPrice:s,customerRatings:l}},Ne=e=>!!e.querySelector(".a-icon-prime"),Oe=e=>"ar"===e?"لا يوجد عروض متوفرة":"fr"===e?"Actuellement indisponible":"de"===e?"Derzeit nicht verfügbar":"Currently unavailable",Ie=e=>{const t=Oe(h.language);return G(e,Oe("en"))||"en"!==h.language&&G(e,t)},Me=(e,t,n)=>{if(e.isDisplayed=!0,t.mainSwitch){if(t.hidePrime&&e.prime&&(e.isDisplayed=!1),t.hideSoldByAmazon&&e.soldByAmazon&&(e.isDisplayed=!1),t.onlyCurrentlyUnavailable&&!e.currentlyUnavailable&&(e.isDisplayed=!1),isFinite(t.maxValBSR)){const n=+t.maxValBSR;n>0&&e.value_BSR>n&&(e.isDisplayed=!1)}if(isFinite(t.minValBSR)){const n=+t.minValBSR;n>0&&e.value_BSR<n&&(e.isDisplayed=!1)}t.hideEmptyBSR&&"-"===e.source_BSR&&(e.isDisplayed=!1),t.hideItemsWithVariation&&e.itemWithVariation&&(e.isDisplayed=!1),n.minPrice&&e.minPrice<n.minPrice&&e.maxPrice<n.minPrice&&(e.isDisplayed=!1),n.maxPrice&&e.minPrice>n.maxPrice&&e.maxPrice>n.maxPrice&&(e.isDisplayed=!1),e.customerRatings&&(n.minCustomerRatings&&e.customerRatings<n.minCustomerRatings&&(e.isDisplayed=!1),n.maxCustomerRatings&&e.customerRatings>n.maxCustomerRatings&&(e.isDisplayed=!1))}},ke=(e,t)=>{e.isDisplayed?"none"===t.style.display&&(t.style.display=""):"none"!==t.style.display&&(t.style.display="none")};function Re(e,t){if(!e.getOfferListingInformation&&!e.isDisplayed)return;if(e.sendQueryOfferListing)return;e.sendQueryOfferListing=!0;const n=new XMLHttpRequest;n.responseType="text",n.open("GET",e.hrefOfferListingInformation,!0),n.send(),n.addEventListener("load",(()=>{200===n.status?A(e,n.responseText,t):(e.errorFetchOfferListingInformation=!0,console.log("cannot get offer listing information on asin: "+e.asin),chrome.runtime.sendMessage({command:"pvv-ext-sendLog-amz-fetch-error",informationType:"offer-page",sourceUrl:document.location.href,requestUrl:e.href,asin:e.asin,statusCode:n.status}))}))}const $e=(e,t,n)=>{let r=e.querySelector(".pvv-ext-divButtonSearchOnEbay");if(!b.mainSwitch||!b.buttonSearchOnEbay)return void(r&&r.remove());if(r)return;r=document.createElement("div"),r.className="pvv-ext-divButtonSearchOnEbay";const o=i(t);let a="https://www.ebay."+h.domain+"/sch/i.html?&_nkw="+o;b.buttonSearchOnEbay_BuyItNow&&(a+="&LH_BIN=1"),b.buttonSearchOnEbay_ItemLocation_NorthAmerica?a+="&LH_PrefLoc=3":a+="&LH_PrefLoc=98";let s="";n&&n.maxPrice&&(s="search with filters (price): ",a+="&_udlo&_udhi="+n.maxPrice,a.indexOf("&LH_BIN=1")||(a+="&LH_BIN=1")),a+="&_sop=12";r.innerHTML=s+'<a href="'+a+'" target="_blank"><input type="image" img src='+de+' style="height:20px;" class="buttonSearchOnEbay" value="Search on ebay" /></a>',e.querySelector(".pvv-ext-wrap-buttons-ebay").append(r)},ze=(e,t,n)=>{let r=e.querySelector(".pvv-ext-divButtonSearchOnWalmart");if(!b.mainSwitch||!b.buttonSearchOnWalmart)return void(r&&r.remove());if(null!==r)return;r=document.createElement("div"),r.className="pvv-ext-divButtonSearchOnWalmart";const o=i(t),a="ca"===h.domain?`https://www.walmart.ca/search?q=${o}`:`https://www.walmart.com/search/?query=${o}`;r.innerHTML='<a href="'+a+'" target="_blank"><input type="image" img src='+ue+' style="height:20px;" class="buttonSearchOnWalmart" value="Search on Walmart" /></a>',e.querySelector(".pvv-ext-wrap-buttons-walmart").append(r)};const He=()=>{document.querySelectorAll(".pvv-ext-FullBSR").forEach((e=>e.remove()))};const De=()=>{if(be||(be=new MutationObserver((()=>setTimeout(De,1e3))),be.observe(document.body,{childList:!0})),document.querySelectorAll(".pvv-ext-BuyerAddressContainer").forEach((e=>e.remove())),!b.mainSwitch)return;h.updateBuyerAddress=!1;let e=document.querySelector("#address-ui-address-form");e||(e=document.querySelector('.a-popover[aria-hidden="false"] #address-ui-checkout-form')),e&&function(){const t=document.createElement("div");t.classList.add("pvv-ext-BuyerAddressContainer"),t.style="margin-bottom: 10px;",e.prepend(t);const n=$(b);t.append(n);const r=document.createElement("div");r.innerHTML='Address (<a id="load-address-from-clipboard" style="cursor: pointer">load from clipboard</a>):',t.appendChild(r),e.querySelectorAll("#load-address-from-clipboard").forEach((e=>{e.addEventListener("click",(()=>{Z(h,De,a)}))}));const o=document.createElement("div");b.buyerAddress.innerHTML?o.innerHTML=b.buyerAddress.innerHTML:o.textContent=b.buyerAddress.text;t.appendChild(o);const i=document.createElement("button");i.type="button",i.innerHTML=`<img src="${me}" style="height: 18px;"/> <span> Paste address </span>`,i.style="margin: 0px; margin-bottom: 5px; margin-right: 10px; padding: 5px; padding-right: 10px;",i.onclick=l,i.classList.add("pvv-ext-AddressButton"),t.prepend(i);const a=document.createElement("div");async function l(){if(!b.active)return n.style="display: block;",void n.scrollIntoView({block:"center",behavior:"smooth"});try{await c()}catch(e){const t=`${e.name}: ${e.message}     Stack: ${e.stack}`;chrome.runtime.sendMessage({command:"pvv-ext-sendLog",type:"error_address_pastingError",data:"Can't paste the address (amazon)",addInfo:{message:t,url:document.location.href}}),s("Can't paste the address")}}async function c(){const t=e.querySelector("#address-ui-widgets-countryCode-dropdown-nativeId");t.value===b.buyerAddress.country?u():(m(t,b.buyerAddress.country),U(t),await d(2e3))}function d(e){return new Promise(((t,n)=>{setTimeout((()=>{u(),t()}),e)}))}function u(){const t=e.querySelector("#address-ui-widgets-enterAddressFullName"),n=e.querySelector("#address-ui-widgets-enterAddressLine1"),r=e.querySelector("#address-ui-widgets-enterAddressLine2"),o=e.querySelector("#address-ui-widgets-enterAddressCity"),i=e.querySelector("#address-ui-widgets-enterAddressStateOrRegion-dropdown-nativeId"),a=e.querySelector("#address-ui-widgets-enterAddressPostalCode"),s=e.querySelector("#address-ui-widgets-enterAddressPhoneNumber");m(t,b.buyerAddress.fullName),m(n,b.buyerAddress.address1),m(r,b.buyerAddress.address2),m(o,b.buyerAddress.city);m(i,I(b.buyerAddress.country).getAmazonStateValue(b.buyerAddress.state)),m(a,b.buyerAddress.zip);m(s,""===b.phone?b.buyerAddress.phone:b.phone)}function m(e,t){e.value=t||"",U(e)}a.classList.add("pvv-ext-msg-wrapper"),t.appendChild(a)}()};function Fe(){return document.querySelector('[aria-label="Include Out of Stock"] input[type="checkbox"]')}const Ue="pvv-ext-filters",Ve="pvv-ext-customer-reviews-filter",Qe="pvv-ext-customer-reviews-min",We="pvv-ext-customer-reviews-max",je="pvv-ext-price-filter",Ge="pvv-ext-price-min",Ke="pvv-ext-price-max",Xe={createMainDiv:()=>{const e=document.createElement("div"),t=k(b.language);return e.className="pvv-ext-mainDiv",e.innerHTML=`<div class="pvv-ext-wrap">\n                            <div class="pvv-ext-wrap-buttons">\n                                <div class="pvv-ext-wrap-buttons-ebay" style="margin: 2px; display: inline-block;"></div>\n                                <div class="pvv-ext-wrap-buttons-walmart" style="margin: 2px; display: inline-block;"></div>\n                            </div>\n                            <div class="pvv-ext-wrap-asin"></div>\n                            <div class="pvv-ext-wrap-BSR" style="position: relative;"></div>\n                            <div class="pvv-ext-wrap-BuyBox"></div>\n                            <div class="pvv-ext-wrap-sellers"></div>\n                            <div class="pvv-ext-wrap-TotalQuantity"></div>\n                            <div class="pvv-ext-wrap-Brand"></div>\n                            <div class="pvv-ext-wrap-ProductInformation"></div>\n                            <div class="pvv-ext-wrap-Price"></div>\n                            <div class="pvv-ext-wrap-ProductDetailsLink"></div>\n                            <div class="pvv-ext-wrap-footer" style="height: 18px;">\n                                <div class="pvv-ext-wrap-footer-grabley" style="display: none;">\n                                    <div style="display: flex; justify-content: flex-end; opacity: 0.5;">\n                                        <a href=${t} target="_blank" style="text-decoration: none; color: inherit;">\n                                            <div style="display: flex; justify-content: flex-end; align-items: center;">\n                                                <div style="font-size: 12px; margin-right: 2px;">by Grabley </div>\n                                                <img src=${he} style="width: 14px; height: 14px">\n                                            </div>\n                                        </a>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>`,e.addEventListener("mouseenter",(e=>{e.target.querySelector(".pvv-ext-wrap-footer-grabley").setAttribute("style","display: block")})),e.addEventListener("mouseleave",(e=>{e.target.querySelector(".pvv-ext-wrap-footer-grabley").setAttribute("style","display: none")})),e},addSearchButtons:(e,t,n)=>{$e(e,t,n),ze(e,t,n)},addASIN:function(e,t){let n=e.querySelector(".pvv-ext-showAsin");if(!b.showAsin)return void(n&&n.remove());if(n)return;n=document.createElement("div"),n.className="pvv-ext-showAsin",n.innerHTML=`<span style="font-size: 10pt;">ASIN ${h.dirRLT?"&rlm;":""}: ${t.asin} </span>\n                            <input class="btnCopyToClipboard"\n                                type="image"\n                                img src=${pe}\n                                style="height: 12px; margin-left: 2px"\n                                data-ext-asin=${t.asin}\n                            />`,n.querySelector(".btnCopyToClipboard").addEventListener("click",(e=>{const t=e.target,n=t?.dataset?.extAsin;n&&navigator.clipboard.writeText(n).then((()=>{t.src=ye,setTimeout((()=>{t.src=pe}),1500)})).catch((e=>{t.src=fe,setTimeout((()=>{t.src=pe}),2e3),s("Error copying ASIN to clipboard. "+e)}))})),e.querySelector(".pvv-ext-wrap-asin").append(n)},removeFullBSR:He,addBSR:function(e,t){let n=e.querySelector(".pvv-ext-BSR");if(b.getBSR){if(n||(n=document.createElement("div"),n.setAttribute("data-empty","#"),n.setAttribute("style","margin:0; color:#000000; font-size:9pt;"),n.className="pvv-ext-BSR",n.innerHTML="# loading...",e.querySelector(".pvv-ext-wrap-BSR").append(n)),(t.errorFetchAdditionalInformation||t.value_BSR_string)&&"#"===n.getAttribute("data-empty")){if(n.setAttribute("data-empty","not empty"),t.errorFetchAdditionalInformation){const e="# can't fetch product data";return void(n.innerHTML=`<span> <b style="color:#d00000;font-size:10pt;"> ${e} </span>`)}n.innerHTML='<a> <span> <b style="color:#d00000;font-size:12pt;">#'+t.value_BSR_string+"</b>&nbsp;"+t.category_BSR+"</span> </a>",t.otherCategoriesBSR&&t.otherCategoriesBSR.length>0&&(n.querySelector("a").onclick=e=>{e.stopPropagation(),He();const r=document.createElement("div");r.className=ve,r.setAttribute("style","font-size:10pt; color:#FFFFFF; border-radius:5px; padding:10px; background-color:rgba(0,0,0,0.8);"),t.otherCategoriesBSR.forEach((e=>{r.innerHTML+=e+"<br>"})),r.style.position="absolute",r.style.left="10px",r.style.top="20px",r.style.zIndex="100",z(r,n)})}}else n&&n.remove()},addBuyBox:function(e,t){let n=e.querySelector(".pvv-ext-BuyBox");b.showBuyBox?(n||(n=document.createElement("div"),n.setAttribute("data-empty","#"),n.setAttribute("style","margin:0; color:#000000; font-size:9pt;"),n.className="pvv-ext-BuyBox",n.innerHTML="#",e.querySelector(".pvv-ext-wrap-BuyBox").append(n)),void 0!==t.buyBox&&"#"===n.getAttribute("data-empty")&&(n.setAttribute("data-empty","not empty"),t.buyBox?n.innerHTML='<span> <b style="color:#0066c0;font-size:10pt;">BuyBox</b></span>':t.buyBox||null!=t.value_BSR&&0!=t.value_BSR?n.innerHTML='<span> <b style="color:#00a000;font-size:10pt;">It has no BuyBox</b></span>':n.innerHTML="")):n&&n.remove()},addPrime:function(e,t){let n=e.querySelector(".pvv-ext-Prime");if(b.showPrime){if(n||(n=document.createElement("div"),n.setAttribute("data-empty","#"),n.setAttribute("style","margin:0; color:#000000; font-size:9pt;"),n.className="pvv-ext-Prime",n.innerHTML="#",e.querySelector(".pvv-ext-wrap-sellers").append(n)),(t.errorFetchOfferListingInformation||t.getQueryOfferListing)&&"#"===n.getAttribute("data-empty")){n.setAttribute("data-empty","not empty");let e="";t.prime&&(e+='<span><b style="color:#4fa3c3;font-size:10pt;">Prime</b></span>'),t.soldByAmazon&&(e+=r(e)?"":" / ",e+='<span><b style="color:#f0c14b;font-size:10pt;">AMZ</b></span>'),t.fbaCount&&(e+=r(e)?"":" / ",e+='<span><b style="color:#d00000;font-size:10pt;">FBA '+t.fbaCount+(t.moreSellersPossible?"+":"")+"</b></span>"),t.fbmCount&&(e+=r(e)?"":" / ",e+='<span><b style="color:#4fa3c3;font-size:10pt;">FBM '+t.fbmCount+(t.moreSellersPossible?"+":"")+"</b></span>"),t.errorFetchOfferListingInformation&&(e+='<span><b style="color:#d00000;font-size:10pt;"># can\'t fetch offer data</b></span>'),n.innerHTML=`<a href=${t.hrefOfferListingWithFilters} target="_blank">${e}</a>`}}else n&&n.remove()},addProductDetailsLink:function(e,t){const n="pvv-ext-ProductDetailsHref";let r,o=e.querySelector("#"+n);if(o&&o.remove(),!b.mainSwitch)return;if(!t.href)return;if(document.querySelector("#prodDetails")?r="prodDetails":document.querySelector("#detail-bullets")?r="detail-bullets":document.querySelector("#detailBullets_feature_div")&&(r="detailBullets_feature_div"),void 0===r)return;const i=document.createElement("a");i.setAttribute("href","#"+r),i.id=n,i.innerHTML="Product information/details",e.querySelector(".pvv-ext-wrap-ProductDetailsLink").append(i)},addBrand:function(e,t){let n=e.querySelector(".pvv-ext-Brand");b.showBrand?(n||(n=document.createElement("div"),n.setAttribute("data-empty","#"),n.setAttribute("style","margin:0; color:#000000; font-size:10pt;"),n.className="pvv-ext-Brand",e.querySelector(".pvv-ext-wrap-Brand").append(n)),t.brand&&"#"===n.getAttribute("data-empty")&&(n.setAttribute("data-empty","not empty"),n.innerHTML=`<b>Brand${h.dirRLT?"&rlm;":""}:</b><span> ${t.brand}</span>`)):n&&n.remove()},addProductInformation:function(e,t){let n=e.querySelector(".pvv-ext-ProductInformation");b.showProductInformation?(n||(n=document.createElement("div"),n.setAttribute("data-empty","#"),n.setAttribute("style","margin:0; color:#000000; font-size:10pt;"),n.className="pvv-ext-ProductInformation",e.querySelector(".pvv-ext-wrap-ProductInformation").append(n)),(t.partNumber||t.itemModelNumber||t.upc)&&"#"===n.getAttribute("data-empty")&&(n.setAttribute("data-empty","not empty"),n.innerHTML="",t.partNumber&&(n.innerHTML+=`<div><b>Part number${h.dirRLT?"&rlm;":""}:</b><span> ${t.partNumber}</span></div>`),t.itemModelNumber&&(n.innerHTML+=`<div><b>Model number${h.dirRLT?"&rlm;":""}:</b><span> ${t.itemModelNumber}</span></div>`),t.upc&&(n.innerHTML+=`<div><b>UPC${h.dirRLT?"&rlm;":""}:</b><span> ${t.upc}</span></div>`))):n&&n.remove()},addPriceData:function(e,t){const n=e.querySelector(".pvv-ext-wrap-Price");n&&(t.minPrice&&n.getAttribute("data-min-price")!==t.minPrice.toString()&&n.setAttribute("data-min-price",t.minPrice),t.maxPrice&&n.getAttribute("data-max-price")!==t.maxPrice.toString()&&n.setAttribute("data-max-price",t.maxPrice))},addPrice:function(e,t){let n=e.querySelector(".pvv-ext-Price");if(n||(n=document.createElement("div"),n.setAttribute("data-empty","#"),n.setAttribute("style","margin:0; color:#000000; font-size:10pt;"),n.className="pvv-ext-Price",e.querySelector(".pvv-ext-wrap-Price").append(n)),t.minPrice&&"#"===n.getAttribute("data-empty")){n.setAttribute("data-empty","not empty");let e=""+t.minPrice;t.minPrice!==t.maxPrice&&(e+=" - "+t.maxPrice),n.innerHTML=`<b>Price:</b> $ ${e}`}},addBtnPasteAddress:De,addBtnCopyBuyerAddress:function(){const e="pvv-ext-divButtonCopyBuyerAddress";if(!b.mainSwitch)return void document.querySelectorAll(".pvv-ext-divButtonCopyBuyerAddress").forEach((e=>e.remove()));if(document.querySelector(".pvv-ext-divButtonCopyBuyerAddress"))return;let t=document.querySelector("#myo-order-details-buyer-address");if(t||(t=document.querySelector('div[data-test-id="shipping-section-buyer-address"]'),t||(t=document.querySelector("#shipping-section-buyer-address"))),!t)return;const n=document.createElement("div");t.parentElement.insertBefore(n,t),n.style="margin-bottom: 5px;",n.classList.add(e);const r=document.createElement("input");r.classList.add(e),r.classList.add("pvv-ext-AddressButton"),n.appendChild(r),r.type="button",r.value="Grabley - Copy address",r.onclick=async function(){r.disabled=!0;let e="";const o=document.querySelector('span[data-test-id="shipping-section-phone"]');let i;o&&(e=o.innerText.trim());try{i=T(t,e)}catch(e){console.log(e);const r=`${e.name}: ${e.message}     Stack: ${e.stack}`;return c("from amz page",t.outerHTML,r,document.location.href),s("Can't parse buyer's address"),void X(n," *** ! copy error ! ***")}const a=[...i.arrAddress,i.phone,void 0].join("\t");navigator.clipboard.writeText(a).then((()=>{})).catch((e=>{s("Error copying address to clipboard. "+e)}));try{await p(i,b.active&&b.useCrossBrowserAddressCopying),Y(n," * copied")}catch(e){X(n," * cross-browser copying error *")}finally{setTimeout((()=>r.disabled=!1),700)}}},hideAdvertisingBlocks:function(){b.mainSwitch&&(b.hideAdvertisingBlocks||b.onlyCurrentlyUnavailable||b.hidePrime)&&(document.querySelectorAll('[data-asin=""]').forEach((e=>{e.classList.contains("a-section")&&!e.querySelector(".sbv-ad-content-container")||(e.style.display="none")})),document.querySelectorAll("#rhf").forEach((e=>{e.style.display="none"})),document.querySelectorAll("#ad").forEach((e=>{e.style.display="none"})),document.querySelectorAll("[data-ad-details]").forEach((e=>{e.style.display="none"})))},getCheckboxIncludeOutOfStock:Fe,turnOffOnlyCurrentlyUnavailableClickCallback:function(){const e=Fe();e&&b.mainSwitch&&b.onlyCurrentlyUnavailable&&e.checked&&(e=>{const t={};t[e]=!1,chrome.storage.local.set(t)})("onlyCurrentlyUnavailable")},addPriceFilter:(e,t)=>{const n=je,r=e?.querySelector("#"+n);if(!r)return;if(!b.mainSwitch||!t)return void(0!==r.children.length&&(r.setAttribute("style","margin-bottom: 0px"),r.innerHTML=""));if(0!==r.children.length)return;const o=Ge,i=Ke,a="pvv-ext-clear-price-filters-btn";r.setAttribute("style","margin-bottom: 14px"),r.innerHTML=`\n        <div><img src=${he} style="width: 14px; height: 14px; margin-right: 5px;">Price  filter:</div>\n        <div style="display: flex; align-items: center;">\n            <input type="text" maxlength="9" id="${o}" placeholder="Min" name="${o}" class="a-input-text a-spacing-top-mini" style="width: 70px;">\n            <input type="text" maxlength="9" id="${i}" placeholder="Max" name="${i}" class="a-input-text a-spacing-top-mini" style="width: 70px;">\n            <span class="a-button a-spacing-top-mini a-button-base s-small-margin-left" style="margin-left: 10px;">\n                <span class="a-button-inner">\n                    <span class="a-button-text" aria-hidden="true" id=${a}>X Clear</span>\n                </span>\n            </span>\n        </div>`;const s=r.querySelector(`#${o}`),l=r.querySelector(`#${i}`),c=sessionStorage.getItem("pvv-ext-min-price"),d=sessionStorage.getItem("pvv-ext-max-price");s&&(c&&(s.value=c),s.addEventListener("input",(e=>{sessionStorage.setItem("pvv-ext-min-price",e.target.value)}))),l&&(d&&(l.value=d),l.addEventListener("input",(e=>{sessionStorage.setItem("pvv-ext-max-price",e.target.value)})));const u=r.querySelector("#"+a);u&&u.addEventListener("click",(()=>{s&&(s.value=""),l&&(l.value=""),sessionStorage.removeItem("pvv-ext-min-price"),sessionStorage.removeItem("pvv-ext-max-price")}))},getPageOptions:()=>{let e,t,n,r;const o=document.querySelector(`#${Ge}`),i=document.querySelector(`#${Ke}`);o&&o.value&&(e=+o.value.replace(",",".")),i&&i.value&&(t=+i.value.replace(",","."));const a=document.querySelector(`#${Qe}`),s=document.querySelector(`#${We}`);return a&&a.value&&(n=+a.value.replace(",",".")),s&&s.value&&(r=+s.value.replace(",",".")),{minPrice:e,maxPrice:t,minCustomerRatings:n,maxCustomerRatings:r}},addOffersAvailableQuantity:function e(){let t=0;const n=document.querySelector("#aod-offer-list");if(!n)return ge&&ge.disconnect(),void document.querySelectorAll(".pvv-ext-wrap-qty").forEach((e=>{e.remove()}));function r(e){if(e.querySelector(".pvv-ext-wrap-qty"))return;const n=e.querySelector('[name="submit.addToCart"]');if(!n)return;const r=1+e.querySelectorAll('[id^="aod-offer-qty-component-"] .aod-qty-option').length,o=b.active||t<2;t++;const i=o?r:"",a=document.createElement("div");a.className="pvv-ext-wrap-qty",a.innerHTML=`<div style="display: flex; justify-content: flex-end; align-items: center; margin-top: 5px; margin-right: 4px;">\n            <img src=${he} style="width: 16px; height: 14px; margin-right: 4px;">\n            <div style="font-size: 14px;">Qty: ${i}</div>${getBuyProHTML()}\n        </div>`,n.parentElement.parentElement.parentElement.after(a)}ge||(ge=new MutationObserver(e)),ge.observe(n,{childList:!0}),document.querySelectorAll("#aod-container #aod-pinned-offer").forEach((e=>r(e))),document.querySelectorAll("#aod-container #aod-offer").forEach((e=>r(e)))},addTotalOffersAvailableQuantity:function(e,t,n){let r=e.querySelector(".pvv-ext-total-quantity");if(r||(r=document.createElement("div"),r.setAttribute("data-empty","#"),r.setAttribute("style","margin:0; color:#000000; font-size:9pt;"),r.className="pvv-ext-total-quantity",e.querySelector(".pvv-ext-wrap-TotalQuantity").append(r)),t.totalQuantity&&"#"===r.getAttribute("data-empty")){if(r.setAttribute("data-empty","not empty"),n){const i=t.totalQuantity+(t.moreSellersPossible?"+":"");r.innerHTML=`<a class="pvv-ext-btn-showSellersTable" data-asin: ${t.asin} style="margin-left: 2px;">\n                                        <span style="color:#000000; font-size:10pt;">\n                                            <b>Qty${h.dirRLT?"&rlm;":""}:</b> ${i} (show table)\n                                        </span>\n                                    </a>\n                                    ${o()}`;r.querySelector(".pvv-ext-btn-showSellersTable").addEventListener("click",(e=>{const n=e.target.closest(".pvv-ext-wrap");ae(t,n)}))}else r.innerHTML=`<a target="_blank" style="margin-left:2px;" href=${R(b.language)}>\n                                        <span style="color:#000000; font-size:10pt;">\n                                            <b>Qty${h.dirRLT?"&rlm;":""}:</b>\n                                        </span>\n                                    </a>\n                                    ${o()}`;function o(){return b.active?"":`<a target="_blank" style="margin-left:2px;" href=${R(b.language)}>(buy PRO)</a>`}}},addCustomerReviewsFilter:e=>{const t=Ve,n=e?.querySelector("#"+t);if(!n)return;if(!b.mainSwitch||!b.showCustomerReviewsFilter)return void(0!==n.children.length&&(n.setAttribute("style","margin-bottom: 0px"),n.innerHTML=""));if(0!==n.children.length)return;const r=Qe,o=We,i="pvv-ext-clear-customer-reviews-filters-btn";n.setAttribute("style","margin-bottom: 14px"),n.innerHTML=`\n        <div><img src=${he} style="width: 14px; height: 14px; margin-right: 5px;">Customer reviews filter:</div>\n        <div style="display: flex; align-items: center;">\n            <input type="text" maxlength="9" id="${r}" placeholder="Min" name="${r}" class="a-input-text a-spacing-top-mini" style="width: 70px;">\n            <input type="text" maxlength="9" id="${o}" placeholder="Max" name="${o}" class="a-input-text a-spacing-top-mini" style="width: 70px;">\n            <span class="a-button a-spacing-top-mini a-button-base s-small-margin-left" style="margin-left: 10px;">\n                <span class="a-button-inner">\n                    <span class="a-button-text" aria-hidden="true" id=${i}>X Clear</span>\n                </span>\n            </span>\n        </div>`;const a=n.querySelector(`#${r}`),s=n.querySelector(`#${o}`),l=sessionStorage.getItem("pvv-ext-min-customer-reviews"),c=sessionStorage.getItem("pvv-ext-max-customer-reviews");a&&(l&&(a.value=l),a.addEventListener("input",(e=>{sessionStorage.setItem("pvv-ext-min-customer-reviews",e.target.value)}))),s&&(c&&(s.value=c),s.addEventListener("input",(e=>{sessionStorage.setItem("pvv-ext-max-customer-reviews",e.target.value)})));const d=n.querySelector("#"+i);d&&d.addEventListener("click",(()=>{a&&(a.value=""),s&&(s.value=""),sessionStorage.removeItem("pvv-ext-min-customer-reviews"),sessionStorage.removeItem("pvv-ext-max-customer-reviews")}))},addFiltersWrap:e=>{const t=e.querySelector("#"+Ue);if(!b.mainSwitch)return void(t&&t.remove());if(t)return t;const n=document.createElement("div");return n.id=Ue,n.setAttribute("style","margin-top: 7px; margin-bottom: 14px;"),n.innerHTML=`\n        <div id="${Ve}"></div>\n        <div id="${je}"></div>\n        <hr aria-hidden="true" class="a-divider-normal" style="margin-top: 14px; margin-bottom: 14px;">`,e.prepend(n),n}},Ye={parsingInterval:800,throttlingTimes:1},Ze={timerId:void 0,queue:[],queueAdditional:[],throttlingCount:0,add(e){Ze.queue.find((t=>t.id===e.id))||(Ze.remove(e),Ze.queue.push(e))},addToAdditionalQueue(e){Ze.queueAdditional.find((t=>t.id===e.id))||(Ze.remove(e),Ze.queueAdditional.push(e))},remove(e){Ze.queue=Ze.queue.filter((t=>t.id!==e.id)),Ze.queueAdditional=Ze.queueAdditional.filter((t=>t.id!==e.id))},removeAll(){Ze.queue=[],Ze.queueAdditional=[]},checkOptionsChanges(){const e=b?.ebayOptions;e&&(e?.parsingInterval&&e.parsingInterval!==Ye.parsingInterval&&(Ze.stop(),ne("set parsing interval",e.parsingInterval)),o(Ye,e,"parsingInterval"),o(Ye,e,"throttlingTimes"))},isBlocked(){const e=b?.ebayOptions?.parsingBlockTime;return!!(e&&e>(new Date).getTime())&&(te("block parsing until time:",new Date(e).toLocaleTimeString()),!0)},blockParsing(){Ze.stop(),chrome.runtime.sendMessage({command:"pvv-ext-sendLog-ebay-block-parsing",currentEbayOptions:Ye,informationType:"product-page",sourceUrl:document.location.href})},start(){Ze.checkOptionsChanges(),Ze.isBlocked()?Ze.stop():Ze.timerId||(ne("start parsing"),Ze.timerId=setInterval(Ze.parse,Ye.parsingInterval))},stop(){Ze.timerId&&(ne("stop parsing"),clearInterval(Ze.timerId),Ze.timerId=void 0)},getNextItem(){let e=Ze.queue.shift();return e||(e=Ze.queueAdditional.shift()),e},parse(){if(Ze.isBlocked())return void Ze.stop();let e=Ze.queue.shift();if(!e){if(Ze.throttlingCount++,!(Ze.throttlingCount>Ye.throttlingTimes))return;Ze.throttlingCount=0,e=Ze.queueAdditional.shift()}e&&(e.sentRequest?Ze.parse():Ze.sendQuery(e))},sendQuery:async function(e){e.sentRequest=!0,ne("send query: "+e.id),fetch(e.href).then((t=>{if(!t.ok)throw Ze.logError(e,t.status,"response is not ok"),403===t.status&&Ze.blockParsing(),new Error(`Response status ${t.status}!   url: ${e.href}`);return t.text()})).then((t=>{const n=function(e){const t={receivedResponse:!0,quantityAvailableTxt:"-",quantitySoldTxt:"-",quantity:1,deliveryTxt:"-",returnsTxt:"-",brand:"not found",itemSpecifics:{brand:"",manufacturer:"",type:"",model:"",mpn:"",upc:"",ean:""}},n=u(e).querySelector("body"),r=(e=>{const t=/"maxValue":"([^"]+)"/,n=e.match(t);if(n&&n[1])return n[1];return null})(e);if(isNaN(parseInt(r,10))){let e=n.querySelector(".d-quantity__availability span");if(e||(e=(o=n.querySelectorAll("#qtySubTxt"))[o.length-1]),e){const n=e.innerText.trim();n&&(t.quantityAvailableTxt=n,t.quantity=(e=>{const t=e.match(/\d+/);if(t)return+t[0];const n=new Map;n.set("last one",1),n.set("last two",2),n.set("last three",3);for(const[t,r]of n)if(e.toLowerCase().includes(t.toLowerCase()))return r;return-1})(n))}}else t.quantityAvailableTxt=r,t.quantity=+r;var o;1===t.quantity&&"-"===t.quantityAvailableTxt&&(t.quantityAvailableTxt="1");let i=n.querySelector(".x-quantity__availability span.ux-textspans:last-child");i||(i=n.querySelector('.x-quantity__availability a[data-testid="ux-action"] span'));i||(i=n.querySelector(".d-quantity__availability span.ux-textspans:last-child"));i||(i=n.querySelector('.d-quantity__availability a[data-testid="ux-action"] span'));if(i){const e=["sold","verkauft","vendidos","vendus","venduti","sprzedane","verkocht"],n=i?.innerText?.toLowerCase()?.trim();if(n){const r=e.find((e=>n.includes(e)));r&&(t.quantitySoldTxt=n.replace(r,"").replace(":","").trim())}}let a,s=n.querySelector("#delSummary .vi-acc-del-range")?.innerText;s||(s=n.querySelector("#delSummary div div")?.innerText);s||(s=n.querySelector("#delSummary div")?.innerText);if(!s){const e=n.querySelector(".ux-labels-values--deliverto .ux-labels-values__values.col-9");if(e){s=e.innerText.trim();const t=s.indexOf(" to ");-1!==t&&(s=s.slice(0,t)),s=s.replace("Estimated between","")}}if(!s){const e=n.querySelector(".ux-labels-values--shipping .ux-labels-values__values.col-9");if(e){s=e.innerText.trim();const t="Get it between",n=s.indexOf(t);-1!==n&&(s=s.slice(n));const r=s.indexOf(" to ");-1!==r&&(s=s.slice(0,r)),s=s.replace(t,"")}}if(s){const e=48;s.length>e&&(s=s.slice(0,e)+"..."),t.deliveryTxt=s.trim()}a||(a=n.querySelector(".ux-labels-values--returns .ux-labels-values__values.col-9 > div > div > span"));a||(a=n.querySelector("#vi-ret-accrd-txt"));a||(a=n.querySelector(".ux-labels-values__values-content > div > span"));a||(a=n.querySelector(".vim.x-returns-minview .ux-labels-values__values-content > div > span"));a&&(t.returnsTxt=a.innerText.trim());const l=c(n);if(m(l,t.itemSpecifics),t.itemSpecifics?.brand)t.brand=t.itemSpecifics.brand;else{let e;e||(e=n.querySelector('[itemprop="brand"] > [itemprop="name"]')),e||(e=K(n.querySelectorAll(".ux-labels-values__labels"),"Brand")[0]?.nextSibling),e||(e=K(n.querySelectorAll(".ux-labels-values__labels"),"Marke")[0]?.nextSibling),e||(e=K(n.querySelectorAll(".ux-labels-values__labels"),"Marque")[0]?.nextSibling),e&&(t.brand=e.innerText.trim())}return t;function c(e){const t={},n=(e,t)=>{const n=e.querySelector(`.ux-labels-values--${t} .ux-labels-values__values`);if(n){return"does not apply"===n.textContent.trim().toLowerCase()?null:n.textContent.trim()}return null};return t.brand=n(e,"brand"),t.brand||(t.brand=n(e,"marke")),t.brand||(t.brand=n(e,"marque")),t.manufacturer=n(e,"manufacturer"),t.type=n(e,"type"),t.model=n(e,"model"),t.mpn=n(e,"mpn"),t.upc=n(e,"upc"),t.ean=n(e,"ean"),t}}(t);m(n,e),V(e.element,e),x(e.id,"ProductInformation",n)})).catch((e=>{s(e.message)}))},logError(e,t,n){chrome.runtime.sendMessage({command:"pvv-ext-sendLog-ebay-fetch-error",informationType:"product-page",sourceUrl:document.location.href,requestUrl:e.href})}};chrome.runtime.onMessage.addListener((function(e,t,n){"pvv-ext-onActivatedTabChanged"===e.command&&(e.isActiveTab?Ze.start():Ze.stop())}));const Je=chrome.runtime.getURL("img/amazon.png"),et=chrome.runtime.getURL("img/icon-48.png"),tt=(()=>{const e={};return document.querySelector("#Results")||document.querySelector("#ListViewInner")||document.querySelector(".s-item")?e.search=!0:document.querySelector("#itemTitle")||document.querySelector('[data-testid="x-item-title"]')?e.product=!0:document.querySelector(".module.shipping-address.auto-address-container")&&(e.checkout=!0),e})(),nt=[],rt=e=>nt.find((t=>t.id===e)),ot=e=>{let t,n=e.querySelector("a.s-item__link");return n||(n=e.querySelector(".lvtitle a")),n&&(t=n.href),!t&&b.showLog&&a("ebay - cannot get link from element",e),t},it=(e,t)=>{if(e){const t=e.match(/\/[0-9]{12}/);if(t)return t[0].substring(1)}if(t){const e=t.getAttribute("listingid");if(e)return e}b.showLog&&a("ebay - cannot get itemId from href: "+e)},at=()=>!!b.mainSwitch&&!!(b.ebay_show_QuantityAvailable||b.ebay_show_QuantityItemsSold||b.ebay_show_Returns||b.ebay_show_Delivery||b.ebay_show_Brand||b.ebay_hide_ItemsByQuantity||b.ebay_show_ItemSpecifics),st=(e,t)=>{const n="pvv-ext-AdditionalInformation",r=e.querySelector("."+n);if(r&&r.remove(),!at())return;const o=document.createElement("span");o.classList.add(n),o.classList.add("s-item__detail"),o.classList.add("s-item__detail--secondary");let i=e.querySelector(".s-item__details-section--secondary");if(i||(i=e.querySelector(".s-item__details.clearfix"),i||(i=e.querySelector(".lvdetails"))),i){i.prepend(o);const e=document.createElement("div");e.setAttribute("style","margin:0px; line-height:18px;margin-bottom:8px;"),e.classList.add(n),e.classList.add("pvv-ext-itemId-"+t),e.innerHTML='<hr style="margin-top:0px;margin-bottom:1px;">',o.append(e)}else a("not found right column for item - "+t)},lt=e=>{if(!e.receivedResponse)return;if(!at())return;const t=document.querySelector(`.pvv-ext-itemId-${e.id}`);if(!t)return;e.productInformationAdded=!0,t.dataset.quantity=e.quantity;const n='style="color: #000050;"';if(b.ebay_show_QuantityAvailable&&!t.querySelector(".pvv-ext-quantity")){const r=document.createElement("div");r.classList.add("pvv-ext-quantity"),r.innerHTML="<span "+n+">Quantity: </span>"+e.quantityAvailableTxt,t.append(r)}if(b.ebay_show_QuantityItemsSold&&!t.querySelector(".pvv-ext-quantitySold")){const r=document.createElement("div");r.classList.add("pvv-ext-quantitySold"),r.innerHTML="<span "+n+">Sold: </span>"+e.quantitySoldTxt.replace(" sold",""),t.append(r)}if(b.ebay_show_Delivery&&!t.querySelector(".pvv-ext-delivery")){const r=document.createElement("div");r.classList.add("pvv-ext-delivery"),r.innerHTML="<span "+n+">Delivery: </span>"+e.deliveryTxt,t.append(r)}if(b.ebay_show_Returns&&!t.querySelector(".pvv-ext-returns")){const r=document.createElement("div");r.classList.add("pvv-ext-returns"),r.innerHTML="<span "+n+">Return: </span>"+e.returnsTxt,t.append(r)}if(b.ebay_show_Brand&&!t.querySelector(".pvv-ext-brand")){const r=document.createElement("div");r.classList.add("pvv-ext-brand"),r.innerHTML="<span "+n+">Brand: </span>"+e.brand,t.append(r)}if(b.ebay_show_ItemSpecifics&&!t.querySelector(".pvv-ext-itemSpecifics")){const r=document.createElement("div");r.classList.add("pvv-ext-itemSpecifics"),e.itemSpecifics?.mpn&&(r.innerHTML+="<div><span "+n+">MPN: </span>"+e.itemSpecifics.mpn+"</div>"),e.itemSpecifics?.upc&&(r.innerHTML+="<div><span "+n+">UPC: </span>"+e.itemSpecifics.upc+"</div>"),e.itemSpecifics?.ean&&(r.innerHTML+="<div><span "+n+">EAN: </span>"+e.itemSpecifics.ean+"</div>"),t.append(r)}},ct=async(e,t)=>{const n=await S(e.id,"ProductInformation");if(n)return m(n,e),void V(e.element,e);e.sentRequest||("high"===t?Ze.add(e):Ze.addToAdditionalQueue(e))},dt=e=>{const t=(e=>{let t,n,r,o="",i=!1;return o=(e.querySelector(".s-item__title")||e.querySelector(".lvtitle a"))?.innerText.trim(),r=ot(e),n=it(r,e),(e.querySelector(".s-item__fnf")||e.querySelector(".s-item__freeXDays"))&&(i=!0),n&&r&&o||(t=`ebay getItemData - Can't get item data from ${e}`),{error:t,id:n,href:r,title:o,fastAndFree:i}})(e);if(!t.error&&!rt(t.id)){const n=(({id:e,title:t,href:n,element:r,isDisplayed:o=!0,fastAndFree:i=!1})=>({id:e,title:t,href:n,sentRequest:!1,receivedResponse:!1,element:r,isDisplayed:o,fastAndFree:i,isVisible:!1,productInformationAdded:!1}))({...t,element:e});(e=>{nt.push(e)})(n)}},ut=e=>{e.isDisplayed=!0,b.ebay_only_FastAndFree&&!e.fastAndFree&&(e.isDisplayed=!1),b.ebay_hide_ItemsByQuantity&&e.receivedResponse&&e.quantity<b.ebay_hide_ItemsByQuantity_minQuantity&&(e.isDisplayed=!1)},mt=e=>{if(e.element.hidden=!e.isDisplayed,e.isDisplayed){const t=e.element,n=t.querySelector(".s-item__price")||t.querySelector(".lvprice.prc"),r=t.querySelector(".s-item__logisticsCost")||t.querySelector(".lvshipping");ft(t,n,r),ht(t,e.title,n,!0),st(t,e.id),lt(e)}},pt=e=>{const t=e.detail;t&&(ut(t),mt(t))},yt=()=>{const e=b.buyerAddress;let t=document.querySelector(".pvv-ext-BuyerAddressContainer");if(!b.mainSwitch)return void(t&&t.remove());if(t){if(!h.updateBuyerAddress)return;t&&t.remove(),h.updateBuyerAddress=!1}const n=document.querySelector(".module.shipping-address.auto-address-container");if(!n)return;t=document.createElement("div"),t.style="margin-bottom: 5px;",t.classList.add("pvv-ext-BuyerAddressContainer"),n.parentElement.insertBefore(t,n),c(!0),c(!1,!0),function(){const e=document.createElement("button");e.type="button",e.innerHTML=`<img src="${et}" style="height: 15px; position: absolute; left: 3;"/> <span style='margin-left: 18px;'> Set message to seller</span>`,e.style="padding: 5px; margin: 5px; position: relative",e.disabled=!b.ebay_MessageToSeller,t.appendChild(e),e.onclick=async function(){if(!b.active)return r.style="display: block;",void r.scrollIntoView({block:"center",behavior:"smooth"});const e=document.querySelector('a[data-test-id="MESSAGE_TO_SELLER_OPEN"]');if(e){const t=await W(e,H,'textarea[data-test-id="MESSAGE_TO_SELLER_TEXT_AREA"]');if(t){t.value=b.ebay_MessageToSeller,t.dispatchEvent(D);const e=document.querySelector('button[data-test-id="MESSAGE_TO_SELLER_SUBMIT"]');e&&e.dispatchEvent(H)}}}}();const r=$(b);t.append(r);const o=document.createElement("div");o.innerHTML='Address (<a id="load-address-from-clipboard" style="cursor: pointer">load from clipboard</a>):',t.appendChild(o);const i=document.querySelector("#load-address-from-clipboard");i&&i.addEventListener("click",(()=>{Z(h,yt,l)}));const a=document.createElement("div");a.style="line-height: 1.3",e&&(e.innerHTML?a.innerHTML=b.buyerAddress.innerHTML:a.textContent=b.buyerAddress.text),t.appendChild(a);const l=document.createElement("div");function c(n,o=!1){const i=document.createElement("button");i.type="button",i.innerHTML=`<img src="${et}" style="height: 15px; position: absolute; left: 3;"/> <span style='margin-left: 18px;'> Add & Paste ${n?" & Save":""} address</span>`,i.style="padding: 5px; margin: 5px; position: relative",i.disabled=void 0===e,o&&i.classList.add("pvv-ext-AddressButton"),i.onclick=async function(){if(!b.active)return r.style="display: block;",void r.scrollIntoView({block:"center",behavior:"smooth"});const t='div.address-list--other-options div.render-summary--primary span a[data-test-id="GET_ADDRESS_FORM"]',o="#country";if(document.querySelector(o))i();else{const e=document.querySelector('[data-test-id="EXPAND_SHIPPING_ADDRESSES"]');if(e){if(!await W(e,H,t,100,5e3))return void s("TimeOut push btnChange")}const n=document.querySelector(t);if(n){if(!await W(n,H,o,100,5e3))return void s("push btnAddNewAddress TimeOut")}document.querySelector(o)&&i()}function i(){const t=document.querySelector(o),r=document.querySelector("#firstName"),i=document.querySelector("#lastName"),a=document.querySelector("#addressLine1"),s=document.querySelector("#addressLine2"),l=document.querySelector("#city"),c=document.querySelector("#stateOrProvince"),d=document.querySelector("#postalCode"),u=document.querySelector("#phoneNumber"),m=document.querySelector(".custom-phone-field__dial-code")||document.querySelector("#phone-country-number");function p(e,t){e.value=t,e.dispatchEvent(F),e.dispatchEvent(D)}async function y(){p(r,e.firstName),p(i,e.lastName),p(a,e.address1),p(s,e.address2),p(l,e.city),p(c,e.state),p(d,e.zip);let t=b.phone||e.phone;if(t&&t.includes("+")&&m){t="+"+t.trim().replace(/\D/g,"");const e=m?.textContent?.trim();if(t.includes(e))t=t.replace(e,"").trim();else{const e=[],n=".listbox-button__options";let r=document.querySelector(n);r?o(e,r):(r=await W(document.querySelector("#phoneCountryCode"),H,n,50,1e3),r&&o(e,r));const i=e.find((e=>t.includes(e.dialCode)));i&&(t=t.replace(i.dialCode,"").trim(),document.querySelector("#"+i.id)?.dispatchEvent(H))}}if(p(u,t),n){const e=document.querySelector(".address-list .btn--primary");e&&setTimeout((()=>{e.dispatchEvent(H)}),300)}function o(e,t){t.querySelectorAll(".listbox-button__option").forEach((t=>{e.push({id:t.id,countryName:t?.querySelector(".custom-phone-field__country-name")?.textContent?.trim(),dialCode:t?.querySelector(".custom-phone-field__dial-code")?.textContent?.trim()})}))}}"US"!==e.country||e.country!==t.value?(p(t,e.country),setTimeout(y,1500)):y()}},t.appendChild(i)}l.classList.add("pvv-ext-msg-wrapper"),t.appendChild(l)};function ft(n,r,o){const i="pvv-ext-Margin",a=n.querySelector("."+i);if(a&&a.remove(),!b.mainSwitch||!b.showMargin)return;const s=r.textContent,l=t(s).minValue;if(!l)return;let c=0;if(o){const n=e(o.textContent);if(o.textContent.includes(n)){const e=t(o.textContent).minValue;c=e||0}}const d=l+c,u=1/(1-b.amazonFee/100),m=(d*u).toFixed(2),p=((d+.3*d)*u).toFixed(2),y=((d+.5*d)*u).toFixed(2),f=((d+1*d)*u).toFixed(2),h=e(s),v="font-size:14px;color:#909090;",g=document.createElement("div");g.style="font-size: 4px; margin-top: 2px; margin-bottom: 8px; line-height: 20px;",g.className=i,g.innerHTML=`\n        <div style="${v}"> ${h} ${m} - 0%</div>   \n        <div style="${v}"> ${h} ${p} - 30%</div>\n        <div style="${v}"> ${h} ${y} - 50%</div>\n        <div style="${v}"> ${h} ${f} - 100%</div>`,r.after(g)}function ht(e,t,n,r=!1){const o="pvv-ext-divButtonSearchOnAmazon",a=e.querySelector("."+o);if(a&&a.remove(),!t||!b.mainSwitch||!b.buttonSearchOnAmazon)return;const s=i(t),l="https://www.amazon."+h.domain+"/s/?field-keywords="+s,c=document.createElement("div");c.style="margin: 2px;",c.className=o,c.innerHTML='<a href="'+l+'" target="_blank"><input type="image" img src='+Je+' style="height:20px;" class="buttonSearchOnAmazon" value="Search on Amazon" /></a>',r?n.parentElement.insertBefore(c,n):n.append(c)}const vt=e=>{let t=e.querySelector('[data-testid="x-price-primary"]');return t||(t=e.querySelector(".mainPrice")?.parentElement),t},gt={addProductInformationWrapper:st,addProductInformation:lt,itemDisplayControl:ut,addBtnPasteAddress:yt,addMargin:ft,addButtonSearchOnAmazon:ht,addBtnSearchDefaultFilters:()=>{const e="pvv-ext-divButtonDefaultFilters",t=document.querySelector("."+e);if(t&&t.remove(),!b.mainSwitch||!b.ebay_button_DefaultFilters)return;const n="com"===h.domain||"ca"===h.domain;let r,o=!1;const i=function(e){for(let t of e){const e=document.querySelector(`[aria-label=${t}]`);if(e)return e}return}(w.newWithCapitalsLetters);i&&(o=i.checked,o||(r=i?.closest("li")?.querySelector("a")?.href));const a=new URL(document.URL),s=a.searchParams.get("LH_BIN"),l=a.searchParams.get("LH_RPA"),c=a.searchParams.get("LH_PrefLoc"),d=function(){if("ca"===h.domain)return"1";return"3"}();if("1"!==s||"1"!==l||n&&c!==d||!o){const t=!o&&r?r:document.URL,i=new URL(t);i.searchParams.delete("LH_Auction"),i.searchParams.set("LH_BIN","1"),i.searchParams.set("LH_RPA","1"),n&&i.searchParams.set("LH_PrefLoc",d),function(t,n){const r=document.createElement("div");r.style="margin-bottom: 15px;",r.className=e;const o=n?"Location / ":" ";r.innerHTML="<a href="+t+"><button>New / Buy It Now / "+o+"Returns accepted</button></a>";let i=document.querySelector(".x-refine__body");if(i)return void i?.parentElement?.insertBefore(r,i);i=document.querySelector("#LeftNavCategoryContainer"),i||(i=document.querySelector("#LeftNavContainer"),i||(i=document.querySelector("#w1-w0"),i||(i=document.querySelector("#leftnav"))));i&&i.parentElement.insertBefore(r,i)}(i.toString(),n)}}},bt=chrome.runtime.getURL("img/icon-48.png"),St=chrome.runtime.getURL("img/amazon.png"),xt=chrome.runtime.getURL("img/ebay.png"),wt=()=>{const e={addressSelect:!1,addressSelectVersion:"",search:!1,product:!1},t=document.location.href;return t.includes("walmart.com")?document.querySelector("form.delivery-identity.accordion-form")?(e.addressSelect=!0,e.addressSelectVersion="v1.5",e):document.querySelector("#add-edit-address-form")?(e.addressSelect=!0,e.addressSelectVersion="v1.6.6",e):t.includes("walmart.com/ip")?(e.product=!0,e):t.includes("walmart.com/search")||document.querySelector("[data-item-id]>[link-identifier]")?(e.search=!0,e):e:e};let qt=wt();const At=()=>{const e=b.buyerAddress;let t=document.querySelector(".pvv-ext-BuyerAddressContainer");if(!b.mainSwitch||!e)return void(t&&t.remove());if(t){if(!h.updateBuyerAddress)return;t&&t.remove(),h.updateBuyerAddress=!1}const n="v1.5"===qt.addressSelectVersion?document.querySelector("form.delivery-identity.accordion-form"):document.querySelector("#add-edit-address-form");if(!n)return;t=document.createElement("div"),t.style="margin-top: 5px; margin-bottom: 10px;",t.classList.add("pvv-ext-BuyerAddressContainer"),n.parentElement.insertBefore(t,n),function(n){const o=document.createElement("button");o.type="button",o.innerHTML=`<img src="${bt}" style="height: 18px;"/> <span> Paste address </span>`,o.style="margin-top: 10px; margin-bottom: 5px;",o.disabled=void 0===e,o.onclick=function(){if(!b.active)return r.style="display: block;",void r.scrollIntoView({block:"center",behavior:"smooth"});!function(){const t="v1.5"===qt.addressSelectVersion?document.querySelector("#firstName"):document.querySelector('[name="firstName"]'),n="v1.5"===qt.addressSelectVersion?document.querySelector("#lastName"):document.querySelector('[name="lastName"]'),r="v1.5"===qt.addressSelectVersion?document.querySelector("#addressLineOne"):document.querySelector('[name="addressLineOne"]'),o="v1.5"===qt.addressSelectVersion?document.querySelector("#addressLineTwo"):document.querySelector('[name="addressLineTwo"]'),i="v1.5"===qt.addressSelectVersion?document.querySelector("#city"):document.querySelector('[name="city"]'),a="v1.5"===qt.addressSelectVersion?document.querySelector("#state"):document.querySelector('[name="state"]'),s="v1.5"===qt.addressSelectVersion?document.querySelector("#postalCode"):document.querySelector('[name="postalCode"]'),l="v1.5"===qt.addressSelectVersion?document.querySelector("#phone"):document.querySelector('[name="phone"]');function c(e,t){null!=t&&0!=t.length&&(e.value=t,e.dispatchEvent(D))}!function(){c(t,e.firstName),c(n,e.lastName),c(r,e.address1),c(o,e.address2),c(i,e.city),c(a,e.state),c(s,e.zip);let d=b.phone?b.phone:e.phone;c(l,d),l.value=d}()}()},o.classList.add("pvv-ext-AddressButton"),t.appendChild(o)}();const r=$(b);t.append(r);const o=document.createElement("div");o.innerHTML='Address (<a id="load-address-from-clipboard" style="cursor: pointer; color: blue">load from clipboard</a>):',t.appendChild(o);const i=document.querySelector("#load-address-from-clipboard");i&&i.addEventListener("click",(()=>{Z(h,At,s)}));const a=document.createElement("div");a.style="line-height: 1.3",e&&(e.innerHTML?a.innerHTML=b.buyerAddress.innerHTML:a.textContent=b.buyerAddress.text),t.appendChild(a);const s=document.createElement("div");s.classList.add("pvv-ext-msg-wrapper"),t.appendChild(s)},Lt=()=>{const e=document.createElement("div");return e.className="pvv-ext-mainDiv",e.innerHTML='<hr style="margin-top:0px; margin-bottom:0px; border: 0px solid #f1f1f2; border-bottom-width: 1px;">\n                         <div class="pvv-ext-wrap-buttons">\n                            <div class="pvv-ext-wrap-buttons-amz" style="display: inline-block;"></div>\n                            <div class="pvv-ext-wrap-buttons-ebay" style="display: inline-block;"></div>\n                        </div>',e},Ct={addBtnPasteAddress:At,addSearchButtons:()=>{if(qt.search){document.querySelectorAll("[data-item-id]>[link-identifier]").forEach((n=>{const r=n?.parentNode;if(!r)return;const o=r.querySelector('[data-automation-id="product-title"]');if(!o)return;let i=r?.parentNode?.querySelector(".pvv-ext-mainDiv");i||(i=Lt(),z(i,r));const a=o?.textContent?.trim();e(i,a),t(i,a)}))}else if(qt.product){const n=document.querySelector('div>section>[itemprop="name"]');if(!n)return;let r=document.querySelector(".pvv-ext-mainDiv");r||(r=Lt(),z(r,n));const o=n?.textContent?.trim();e(r,o),t(r,o)}function e(e,t){const n="pvv-ext-divButtonSearchOnAmazon";let r=e.querySelector("."+n);if(!b.mainSwitch||!b.walmartAddButtonSearchOnAmazon)return void(r&&r.remove());if(r)return;const o=i(t),a="https://www.amazon."+h.domain+"/s/?field-keywords="+o;r=document.createElement("div"),r.style="margin: 2px;",r.className=n,r.innerHTML='<a href="'+a+'" target="_blank"><input type="image" img src='+St+' style="height: 20px; padding-top: 1px;" class="buttonSearchOnAmazon" value="Search on Amazon" /></a>',e.querySelector(".pvv-ext-wrap-buttons-amz").append(r)}function t(e,t){const n="pvv-ext-divButtonSearchOnEbay";let r=e.querySelector("."+n);if(!b.mainSwitch||!b.walmartAddButtonSearchOnEbay)return void(r&&r.remove());if(r)return;const o=i(t);let a="https://www.ebay."+h.domain+"/sch/i.html?&_nkw="+o;b.walmartAddButtonSearchOnEbay_BuyItNow&&(a+="&LH_BIN=1"),b.walmartAddButtonSearchOnEbay_ItemLocation_NorthAmerica?a+="&LH_PrefLoc=3":a+="&LH_PrefLoc=98",a+="&_sop=12",r=document.createElement("div"),r.style="margin: 2px;",r.className=n,r.innerHTML='<a href="'+a+'" target="_blank"><input type="image" img src='+xt+' style="height:17px;" value="Search on ebay" /></a>',e.querySelector(".pvv-ext-wrap-buttons-ebay").append(r)}}},Et=chrome.runtime.getURL("img/icon-48.png"),_t=()=>{const e={addressSelect:!1,addressSelectVersion:""};return document.location.href.includes("totalelement.com")?(document.querySelector("#checkout_shipping_address_address1")&&(e.addressSelect=!0,e.addressSelectVersion="v1.5.7"),(document.querySelector("#shippingAddressForm")||document.querySelector('[name = "lastName"]')&&document.querySelector('[name = "address1"]'))&&(e.addressSelect=!0,e.addressSelectVersion="v2.0.10"),e):e};let Bt=_t();const Tt=()=>{const e=b.buyerAddress;let t=document.querySelector(".pvv-ext-BuyerAddressContainer");if(!b.mainSwitch)return void(t&&t.remove());if(t){if(!h.updateBuyerAddress)return;t&&t.remove(),h.updateBuyerAddress=!1}const n=document.querySelector('[name = "countryCode"]'),r=document.querySelector("#shippingAddressForm")||document.querySelector(".address-fields")||n?.parentElement;if(!r)return;t=document.createElement("div"),t.style="margin-top: 5px; margin-bottom: 10px; margin-left: 10px;",t.classList.add("pvv-ext-BuyerAddressContainer"),r?.parentElement?.insertBefore(t,r),function(){const n=document.createElement("button");n.type="button",n.innerHTML=`<img src="${Et}" style="height: 18px;"/> <span> Paste address </span>`,n.innerHTML=`<img src="${Et}" style="height: 18px; position: absolute; left: 3;"/> <span style='margin-left: 20px;'> Paste address</span>`,n.classList.add("pvv-ext-AddressButton"),n.style="padding: 5px; padding-right: 10px; margin: 5px; position: relative; border: 1px solid;",n.disabled=void 0===e,n.onclick=function(){if(!b.active)return o.style="display: block;",void o.scrollIntoView({block:"center",behavior:"smooth"});!function(){const t=document.querySelector('[name = "countryCode"]')||document.querySelector("#checkout_shipping_address_country"),n=document.querySelector('[name = "firstName"]')||document.querySelector("#checkout_shipping_address_first_name"),r=document.querySelector('[name = "lastName"]')||document.querySelector("#checkout_shipping_address_last_name"),o=document.querySelector('[name = "address1"]')||document.querySelector("#checkout_shipping_address_address1"),i=document.querySelector('[name = "address2"]')||document.querySelector("#checkout_shipping_address_address2"),a=document.querySelector('[name = "city"]')||document.querySelector("#checkout_shipping_address_city"),s=document.querySelector('[name = "postalCode"]')||document.querySelector("#checkout_shipping_address_zip"),l=document.querySelector('[name = "phone"]')||document.querySelector("#checkout_shipping_address_phone");function c(e,t){if("SELECT"===e.nodeName)for(let n=0;n<e.options.length;n++)if(e.options[n].value===t||e.options[n].dataset.code===t){e.options[n].selected=!0;break}e.value=t,e.dispatchEvent(F),e.dispatchEvent(D)}function d(){const t=document.querySelector('[name = "zone"]')||document.querySelector("#checkout_shipping_address_province");c(n,e.firstName),c(r,e.lastName),c(o,e.address1),c(i,e.address2),c(a,e.city),c(t,e.state),c(s,e.zip);const d=b.phone?b.phone:e.phone;c(l,d)}t.value===e.country?d():(c(t,e.country),setTimeout(d,500))}()},t.appendChild(n)}();const o=$(b);t.append(o);const i=document.createElement("div");i.innerHTML='Address (<a id="load-address-from-clipboard" style="cursor: pointer; color: blue">load from clipboard</a>):',t.appendChild(i);const a=document.querySelector("#load-address-from-clipboard");a&&a.addEventListener("click",(()=>{Z(h,Tt,l)}));const s=document.createElement("div");s.style="line-height: 1.3",e&&(e.innerHTML?s.innerHTML=b.buyerAddress.innerHTML:s.textContent=b.buyerAddress.text),t.appendChild(s);const l=document.createElement("div");l.classList.add("pvv-ext-msg-wrapper"),t.appendChild(l)},Pt={addBtnPasteAddress:Tt},Nt=chrome.runtime.getURL("img/icon-48.png"),Ot=chrome.runtime.getURL("img/spinner.gif"),It=".comet-modal-body .deliver-address-wrap",Mt=()=>{const e={addressSelect:!1,search:!1,product:!1};return document.location.href.includes(".aliexpress.")&&document.querySelector(It)&&document.querySelector(".sdk-country-flag")?(e.addressSelect=!0,e):e};let kt=Mt();const Rt=()=>document.querySelector(".pvv-ext-BuyerAddressContainer"),$t=()=>{const e=b.buyerAddress;let t=Rt();if(!b.mainSwitch)return void(t&&t.remove());if(t){if(!h.updateBuyerAddress)return;t.remove(),h.updateBuyerAddress=!1}const n=document.querySelector(It);if(!n)return;t=document.createElement("div"),t.setAttribute("style","margin-bottom: 5px; margin-left: 15px;"),t.classList.add("pvv-ext-BuyerAddressContainer"),n.parentElement.insertBefore(t,n),function(){const n=document.createElement("button");n.type="button",n.innerHTML=`<img src="${Nt}" style="height: 18px;"/> <span> Paste address </span>`,n.disabled=void 0===e,n.onclick=async function(){if("US"!==e.country&&"CA"!==e.country)return X(l,"For USA and Canada only",15e3),void d("aliexpress",e,"country = "+e.country);if(!b.active)return r.setAttribute("style","display: block;"),void r.scrollIntoView({block:"center",behavior:"smooth"});n.disabled=!0;const t=200,o=1e4,i=I(e.country).getAliexpressStateValue(e.state),a=function(e,t){const n=B(e).trim().replace(/ /g,"").replace(/-/g,"").replace(/\(/g,"").replace(/\)/g,""),r={countryCode:"",phoneNumber:n};return"US"!==t&&"CA"!==t||(10===n.length?r.countryCode="+1":11===n.length&&"1"===n.slice(0,1)?(r.countryCode="+1",r.phoneNumber=n.slice(1)):12===n.length&&"+1"===n.slice(0,2)&&(r.countryCode="+1",r.phoneNumber=n.slice(2))),r}(b.phone?b.phone:e.phone,e.country);let c=e.zip.trim(),u=e.city.trim();"US"===e.country&&(c=c.replace(/ /g,"").replace(/-/g,""));let m=!0;!function(e){e.innerHTML=`<img src=${Ot} style="height: 60px;">`}(l);try{await y()}catch(e){s(e.message)}await j(500);let p=await v();if(p.length>0){p.forEach((e=>s(e)));try{if(await y(),p=await v(),p.length>0){const t=p.join("; ");X(l,t,15e3),d("aliexpress",e,t)}}catch(e){m=!1,s(e.message)}}async function y(){const n=document.querySelector(".sdk-country-flag");if(!n)throw new Error("Can't find countryFlag element.");await async function(n){const r="US"===e.country?"country-us":"country-ca";if(!n.classList.contains(r)){const i=await W(n,H,`.next-overlay-wrapper.opened .option-item-flag.sdk-country-flag.${r}`,t,o);if(!i)throw new Error("Can't change country. [optionCountry]");if(await j(500),!await W(i,H,`i.sdk-country-flag.${r}:not(.option-item-flag)`,t,o))throw new Error("Can't change country. [countryFlagNew]");const a=f(e.country);if(!await Q(a,t,1e3)){const e=await Q(".deliver-address-wrap .text-button-container",t,o);if(e){if(e.dispatchEvent(H),!await Q(a,t,o))throw new Error("Unable to click the 'Enter manually' button");await j(500)}}}}(n),await j(500);const r=document.querySelector(".deliver-address-wrap");if(!r)throw new Error("Can't find deliver-address-wrap element.");const s=await h(e.country,3,500),{firstName:l,lastName:d,fullName:m,phoneCode:p,phoneNumber:y,addressLine1:v,addressLine2:g,region:b,city:S,zip:x,regionParent:w,cityParent:q}=s;if(await j(500),r?.dispatchEvent(H),"US"===e.country?(E(l,e.firstName),E(d,e.lastName)):E(m,e.fullName),E(p,a.countryCode),E(y,a.phoneNumber),E(v,e.address1),E(g,e.address2),E(x,c),await Q("em",t,o,"",b),await Q("em",t,o,"",S),b?.dispatchEvent(H),!await Q('.next-overlay-wrapper.opened ul[role="listbox"]',t,o))throw new Error("Can't change region. [regionListbox]");const A=await Q(`.next-overlay-wrapper.opened [title="${i}"]`,t,o);if(!A)throw new Error("Can't change state. [stateOption]");if(A.dispatchEvent(H),!await Q(`span em[title="${i}"]`,t,o,"",w))throw new Error("Can't change state. [checkRegion]");if(await j(500),S?.dispatchEvent(H),!await Q('.next-overlay-wrapper.opened ul[role="listbox"]:not(.next-select-menu-empty)',t,o))throw new Error("Can't change city. [cityListbox]");const L=e=>`.next-overlay-wrapper.opened [title="${e}" i]`;let C=await Q(L(u),t,o);if(!C){let e=u.toLowerCase();const t=[["st-","saint-"]];for(const n of t){if(e.includes(n[0])&&(e=e.replace(n[0],n[1]),C=document.querySelector(L(e)),C)){u=e;break}if(e.includes(n[1])&&(e=e.replace(n[1],n[0]),C=document.querySelector(L(e)),C)){u=e;break}}if(!C)throw new Error("Can't change city. [cityOption]")}function E(e,t){e.dispatchEvent(H),e.value=t,e.setAttribute("value",t);const n=Object.getOwnPropertyDescriptor(e.__proto__,"value")?.set;n&&n.call(e,t),e.dispatchEvent(D),e.dispatchEvent(F)}C.dispatchEvent(H),await Q(`span em[title="${u}" i]`,t,o,"",q)}function f(e){return'input[placeholder*="Street"]'}async function h(e,t=3,n=500){const r=["phoneCode","phoneNumber","addressLine1","region","city","zip","regionParent","cityParent"];"CA"===e?r.push("fullName"):(r.push("firstName"),r.push("lastName"));const o=e=>{const t=document.querySelector('input[placeholder*="First name"]'),n=document.querySelector('input[placeholder*="Contact name"]'),r=document.querySelector('input[placeholder*="Last name"]'),o=document.querySelector('[role="gridcell"]:has(input[placeholder*="Mobile number"]) input'),i=document.querySelector('input[placeholder*="Mobile number"]'),a=document.querySelector('input[placeholder*="Street"]'),s=document.querySelector('input[placeholder*="Apt"]'),l=document.querySelectorAll('input[placeholder*="ZIP"]'),c=l[l.length-1];if("CA"===e){const e=document.querySelectorAll('[role="gridcell"]')[5],t=e?.querySelector("span"),r=document.querySelectorAll('[role="gridcell"]')[6],l=r?.querySelector("span");return{fullName:n,phoneCode:o,phoneNumber:i,addressLine1:a,addressLine2:s,region:t,city:l,zip:c,regionParent:e,cityParent:r}}const d=document.querySelectorAll('[role="gridcell"]')[7],u=d?.querySelector("span"),m=document.querySelectorAll('[role="gridcell"]')[8],p=m?.querySelector("span");return{firstName:t,lastName:r,phoneCode:o,phoneNumber:i,addressLine1:a,addressLine2:s,region:u,city:p,zip:c,regionParent:d,cityParent:m}};for(let a=1;a<=t;a++){const t=o(e);if(i(t,r))return t;await j(n)}return o(e);function i(e,t){let n=!0;return t.forEach((t=>{e[t]||(n=!1)})),n}}async function v(){const t=[],{firstName:n,lastName:r,fullName:o,phoneCode:s,phoneNumber:l,addressLine1:d,addressLine2:m,zip:p,regionParent:y,cityParent:f}=await h(e.country,1,500);"US"===e.country?(b("FirstName",n,e.firstName,t),b("LastName",r,e.lastName,t)):b("FullName",o,e.fullName,t),b("PhoneCode",s,a.countryCode,t),b("PhoneNumber",l,a.phoneNumber,t),b("AddressLine1",d,e.address1,t),b("AddressLine2",m,e.address2,t);const v=y?.querySelector(`span em[title="${i}"]`);v||t.push("Can't change [State]");const g=f?.querySelector(`span em[title="${u}" i]`);return g||t.push("Can't change [City]"),b("Zip",p,c,t),t;function b(e,t,n,r){(function(e,t){return e?.value?e?.value?.trim().toLowerCase()!==t.trim().toLowerCase():""!==t.trim()})(t,n)&&r.push(`Can't change [${e}]`)}}!function(e){e.innerHTML=""}(l),m?Y(l,"Address insertion was successful",5e3):X(l,"! ! ! Inserting address failed ! ! !",7e3),n.disabled=!1},n.classList.add("pvv-ext-AddressButton"),n.classList.add("comet-btn"),t?.appendChild(n)}();const r=$(b);t.append(r);const o=document.createElement("div");o.innerHTML='Address (<a id="load-address-from-clipboard" style="cursor: pointer; color: blue">load from clipboard</a>):',t.appendChild(o);const i=document.querySelector("#load-address-from-clipboard");i&&i.addEventListener("click",(()=>{Z(h,$t,l)}));const a=document.createElement("span");a.setAttribute("style","line-height: 1.3; display: table-cell;"),e&&(e.innerHTML?a.innerHTML=b.buyerAddress.innerHTML:a.textContent=b.buyerAddress.text),t.appendChild(a);const l=document.createElement("span");l.classList.add("pvv-ext-msg-wrapper"),l.setAttribute("style","padding-left: 40px; display: table-cell; vertical-align: top;"),t.appendChild(l)},zt={addBtnPasteAddress:$t,clearBtnPasteAddress:()=>{const e=Rt();e&&e.remove()}};a("Grabley extension connected!");let Ht,Dt=1e3;var Ft;document.addEventListener("keydown",(e=>{if(!e.altKey||"KeyX"!==e.code&&"KeyC"!==e.code||setTimeout((()=>{const e=document.querySelector(".pvv-ext-AddressButton");e&&!e.disabled&&e.dispatchEvent(new Event("click"))}),100),e.altKey&&"Digit1"===e.code&&g(b,"hidePrime")){const e=!b.hidePrime;chrome.storage.local.set({hidePrime:e}),"popup"!==Ft&&ee(e,'Hide - "prime" items')}if(e.altKey&&"Digit2"===e.code&&g(b,"hideSoldByAmazon")){const e=!b.hideSoldByAmazon;chrome.storage.local.set({hideSoldByAmazon:e}),"popup"!==Ft&&ee(e,"Hide - Sold by Amazon")}}));const Ut={getElemOrderIdValue:function(){return document.querySelector('span[data-test-id="order-id-value"]')},isOrderPage:function(){return!!Ut.getElemOrderIdValue()},addBtnCopyOrderID:function(){const e="pvv-ext-BtnCopyOrderID-Container";let t=document.querySelector("."+e);if(!b.mainSwitch)return void(t&&t.remove());if(t)return;const n=Ut.getElemOrderIdValue();if(null===n)return;t=document.createElement("span"),t.style="margin-left: 5px; margin-right: 5px;",t.classList.add(e),z(t,n);const r=document.createElement("a");r.title='Copy "Order ID" to clipboard (grabley)',r.textContent="(Copy)",r.onclick=function(){navigator.clipboard.writeText(n.textContent).then((()=>{r.textContent="(Copied success)",setTimeout((function(){r.textContent="(Copy)"}),1500)})).catch((e=>{r.textContent="(Error! Failed to copy ID)",r.style="color: red; font-weight: bold",setTimeout((function(){t.remove()}),3e3),console.log("ERROR! Failed to copy ID. "+e)}))},t.appendChild(r)},observeElements:[],unobserveAll:function(){Ut.observeElements.forEach((e=>Wt.unobserve(e))),Ut.observeElements=[]},observe:function(e){Ut.observeElements.push(e),Wt.observe(e)},parsing:{queue:[],queueAdditional:[],add:function(e){void 0===Ut.parsing.queue.find((t=>t.asin===e.asin))&&Ut.parsing.queue.push(e)},addToAdditionalQueue(e){void 0===Ut.parsing.queueAdditional.find((t=>t.asin===e.asin))&&Ut.parsing.queueAdditional.push(e)},removeAll:function(){Ut.parsing.queue=[],Ut.parsing.queueAdditional=[]},start:function(){setInterval(Ut.parsing.parse,300)},parse:function(){if(!b.mainSwitch)return;let e=Ut.parsing.queue.shift();void 0===e&&(e=Ut.parsing.queueAdditional.shift()),void 0!==e&&async function(e){if(!e.href)return;if(e.sendQueryAdditionalInformation)return;e.sendQueryAdditionalInformation=!0;const t=await S(e.asin,"AdditionalInformation");if(t)return void m(t,e,["minPrice","maxPrice"]);const n=new XMLHttpRequest;n.responseType="text",n.open("GET",e.href,!0),n.send(),n.addEventListener("load",(()=>{200===n.status?E(e,n.response):(e.errorFetchAdditionalInformation=!0,console.log("cannot get add.information on asin: "+e.asin),chrome.runtime.sendMessage({command:"pvv-ext-sendLog-amz-fetch-error",informationType:"product-page",sourceUrl:document.location.href,requestUrl:e.href,asin:e.asin,statusCode:n.status}))}))}(e)}},paramOutOfStock:"rh=p_n_availability%3A2661601011",elementIdOutOfStock:"p_n_availability/2661601011",isURLIncludesOutOfStockParam:e=>e.includes(Ut.paramOutOfStock),addOutOfStockParamToURL:e=>e+"&"+Ut.paramOutOfStock};if(h.amazon){if(Ut.parsing.start(),document.addEventListener("click",Xe.removeFullBSR),h.itemList||h.amzSellercentral){function Yt(){Ht!==document.URL&&(Ut.mainItem=void 0,Ht=document.URL,jt())}Ht=document.URL,setInterval(Yt,1e3)}let Kt=0;function Xt(){const e=document.querySelectorAll("#address-ui-widgets-enterAddressLine1").length;Kt!==e&&(Kt=e,we=xe(),jt(),Vt())}setInterval(Xt,1500),!b.active&&h.amazon&&we.product&&chrome.runtime.sendMessage({command:"pvv-ext-amz-increaseCountShowedQuantityOnProductPage"})}if(h.grabley){document.querySelector("#authorized")&&chrome.runtime.sendMessage({command:"pvv-ext-authorization",context:"content_script",addition:"User Profile"});document.querySelector("#no-offers")&&chrome.runtime.sendMessage({command:"pvv-ext-sendPing"})}if(h.ebay&&tt.product){const Zt=vt(document);if(Zt){let Jt=t(Zt.textContent).minValue;new MutationObserver((e=>{const n=t(Zt.textContent).minValue;n!==Jt?(Jt=n,jt(!1)):jt(!1,{ebay:{withoutReRendering:!0}})})).observe(Zt.parentNode,{attributes:!1,childList:!0,subtree:!0,characterData:!0})}}function Vt(){b.active&&b.useCrossBrowserAddressCopying&&(tt.checkout||we.addressSelect||qt.addressSelect||Bt.addressSelect)&&chrome.runtime.sendMessage({command:"pvv-ext-updateBuyerAddressFromGrabley"})}const Qt=(e=!1)=>{e&&h.amazon&&(Se=b.active||b.amz_showQuantityOnProductPage),jt(e,{optionsChanged:!0})};chrome.storage.local.get(null,(function(e){for(let t in e){const n=e[t];g(b,t)&&(b[t]=n),"buyerAddress"===t&&(h.updateBuyerAddress=!0)}h.amazon||Vt(),Qt(!0)})),chrome.storage.onChanged.addListener((function(e,t){b.prev={...b};let n=!1;for(const t in e){const r=e[t].newValue;b[t]=r,"active"!==t&&"useCrossBrowserAddressCopying"!==t||(n=!0),"buyerAddress"===t&&(h.updateBuyerAddress=!0)}n&&Vt(),Qt()}));const Wt=new IntersectionObserver((function(e,t){h.amazon&&Ut.parsing.removeAll(),e.forEach((e=>{if(h.amazon){const t=Pe(e.target),n=Le(t.asin);if(void 0===n)return void console.log("error: ",e.target);b.mainSwitch&&(b.getBSR||b.showBuyBox||b.hideItemsWithVariation||b.showBrand||b.showProductInformation)&&n.isDisplayed&&!n.sendQueryAdditionalInformation&&(e.isIntersecting?Ut.parsing.add(n):Ut.parsing.addToAdditionalQueue(n))}if(h.ebay){const t=ot(e.target),n=it(t,e.target);if(n){const t=rt(n);t&&at()&&(t.isVisible=e.isIntersecting)}}})),h.ebay&&(()=>{if(Ze.removeAll(),!at())return;const e=nt.findIndex((e=>e.isVisible));if(-1===e)nt.filter((e=>e.isDisplayed&&!e.productInformationAdded)).forEach((e=>{ct(e,e.isVisible?"high":"low")}));else{const t=nt.filter((e=>e.isDisplayed&&e.isVisible&&!e.sentRequest&&!e.productInformationAdded)),n=[],r=nt.slice(0,e).filter((e=>e.isDisplayed&&!e.isVisible&&!e.sentRequest&&!e.productInformationAdded)),o=nt.slice(e+1).filter((e=>e.isDisplayed&&!e.isVisible&&!e.sentRequest&&!e.productInformationAdded));r.reverse();const i=Math.max(r.length,o.length);for(let e=0;e<i;e++){const t=o[e],i=r[e];t&&n.push(t),i&&n.push(i)}t.forEach((e=>ct(e,"high"))),n.forEach((e=>ct(e,"low")))}Ze.start()})()}),{root:null,rootMargin:"0px",threshold:.1});function jt(e,t){if(h.amazon){if(we.search||we.bestsellers||we.deals){if(t?.optionsChanged&&document.querySelectorAll(".pvv-ext-divButtonSearchOnEbay").forEach((e=>e.remove())),we.search){const t=Xe.getCheckboxIncludeOutOfStock();if(t?.parentElement?.addEventListener("click",Xe.turnOffOnlyCurrentlyUnavailableClickCallback),b.mainSwitch&&b.onlyCurrentlyUnavailable&&t&&!t.checked)return t.dispatchEvent(H),void(e&&setTimeout((()=>jt(e)),3e3));Gt('[data-asin]:not([data-asin=""])'),Xe.hideAdvertisingBlocks()}if(we.bestsellers&&(Xe.hideAdvertisingBlocks(),Gt("#gridItemRoot"),b.mainSwitch)){const e=document.querySelectorAll("#gridItemRoot"),t="570px";e.forEach((e=>{e.style.height!==t&&(e.style.height=t)}))}we.deals,b.mainSwitch&&b.showPrime&&Ce().forEach((e=>{Re(e)})),e&&setTimeout((function(){jt(e)}),Dt)}if(h.itemList){let e=document.querySelector(".pvv-ext-mainDiv");if(e&&e.remove(),!b.mainSwitch)return;e=Xe.createMainDiv();let t=document.querySelector("#titleSection").parentElement;if(!t)return;z(e,t);const n=document.querySelector("#productTitle")?.textContent.trim(),r=window.location.href;let o=document.querySelector("#ASIN")?.value;if(o||(o=_e(r)),!n&&!o)return;const i=Te();if(!Le(o)){const e=Ee({asin:o,title:n,href:r,qid:i,getOfferListingInformation:!0});Ae(e)}const a=Le(o);a&&(E(a,document),Re(a,jt),Xe.addSearchButtons(e,a.title),Xe.addASIN(e,a),Xe.addBSR(e,a),Xe.addPrime(e,a),Xe.addTotalOffersAvailableQuantity(e,a,Se),Xe.addProductDetailsLink(e,a),Xe.addPriceData(e,a),Xe.addBrand(e,a),Xe.addProductInformation(e,a),setTimeout(Xe.addOffersAvailableQuantity,1500))}h.buyerAddress&&Xe.addBtnCopyBuyerAddress(),h.amzSellercentral&&((document.querySelector("#myo-order-details-buyer-address")||document.querySelector('div[data-test-id="shipping-section-buyer-address"]')||document.querySelector("#shipping-section-buyer-address"))&&(h.buyerAddress=!0),e&&setTimeout((function(){jt(e)}),Dt)),we.addressSelect&&Xe.addBtnPasteAddress(),Ut.isOrderPage()&&Ut.addBtnCopyOrderID()}if(h.ebay){if(tt.product){let e=!0;if(t?.ebay?.withoutReRendering){document.querySelector(".pvv-ext-Margin")&&(e=!1)}if(e){const e=vt(document);if(e){const t=document.querySelector(".ux-labels-values--shipping .ux-textspans--BOLD");gt.addMargin(document,e,t)}}let n=document.querySelector('[data-testid="x-item-title"]');n||(n=document.querySelector("#vi-lkhdr-itmTitl"));const r=n?.textContent;gt.addButtonSearchOnAmazon(document,r,n)}tt.search&&(gt.addBtnSearchDefaultFilters(),(()=>{if(!b.mainSwitch)return void nt.forEach((e=>{e.isDisplayed=!0}));document.querySelectorAll(".sresult").forEach((e=>{dt(e),e.addEventListener("updateDataEvent",pt)})),document.querySelectorAll(".srp-results .s-item[id]").forEach((e=>{dt(e),e.addEventListener("updateDataEvent",pt)}));const e=document.querySelectorAll("div .srp-items-carousel__items-container");document.querySelectorAll("#mainContent li.s-item").forEach((t=>{let n=!1;e.length>0&&e.forEach((e=>{e.contains(t)&&(n=!0)})),n||(dt(t),t.addEventListener("updateDataEvent",pt))})),nt.forEach((e=>{ut(e)}))})(),nt.forEach((e=>{mt(e)})),at()&&[...nt].filter((e=>e.isDisplayed)).forEach((e=>{Wt.observe(e.element)})),Ze.start()),tt.checkout&&(gt.addBtnPasteAddress(),e&&setTimeout((()=>jt(e)),Dt))}if(h.walmart){if(qt=wt(),!b.mainSwitch)return void document.querySelectorAll(".pvv-ext-mainDiv").forEach((e=>e.remove()));t?.optionsChanged&&document.querySelectorAll(".pvv-ext-divButtonSearchOnEbay").forEach((e=>e.remove())),qt.search&&Ct.addSearchButtons(),qt.product&&Ct.addSearchButtons(),qt.addressSelect&&Ct.addBtnPasteAddress(),e&&setTimeout((()=>jt(e)),Dt)}h.totalelement&&(Bt.addressSelect?Pt.addBtnPasteAddress():(Bt=_t(),Bt.addressSelect&&Vt()),e&&setTimeout((function(){jt(e)}),2e3)),h.aliexpress&&(kt=Mt(),kt.addressSelect?zt.addBtnPasteAddress():zt.clearBtnPasteAddress(),e&&setTimeout((()=>jt(e)),Dt))}function Gt(e){Ut.unobserveAll();let t=0;const n=document.querySelectorAll(e);if(0===n.length)return;Ce().forEach((e=>e.isDisplayed=!1));const r=document.querySelector("#s-refinements");if(r){const e=Xe.addFiltersWrap(r);Xe.addCustomerReviewsFilter(e);const t=!document.querySelector("#low-price")&&!document.querySelector("#filter-p_36");Xe.addPriceFilter(e,t)}const o=Xe.getPageOptions();for(let e=0;e<n.length;e++){const r=n[e],{error:i,asin:a,href:l,title:c,qid:d,minPrice:u,maxPrice:m,customerRatings:p}=Pe(r);if(i)continue;if(Ut.observe(r),!Le(a)){const e=Ee({asin:a,title:c,href:l,qid:d,prime:Ne(r),currentlyUnavailable:Ie(r),element:r,minPrice:u,maxPrice:m,customerRatings:p});Ae(e)}const y=Le(a);if(y){if(Me(y,b,o),ke(y,r),!y.isDisplayed)continue;let e=r.querySelector(".pvv-ext-mainDiv");if(!b.mainSwitch){e&&e.remove();continue}if(!e){if(e=Xe.createMainDiv(),h.searchList){let t=!1,n=null;h.searchList&&(t||(n=r.querySelector("h2 > a"),null!==n&&(t=!0,n.parentElement.parentElement.appendChild(e))),t||(n=r.querySelector("div.a-section.a-spacing-none a.a-link-normal"),null!==n&&(t=!0,n.parentElement.parentElement.appendChild(e))),t||(n=r.querySelector("div.sg-row:nth-child(2)>div:nth-child(2)"),null!==n&&(t=!0,n.parentElement.insertBefore(e,n),e.style["padding-left"]="12px")),t||(n=r.querySelector(".s-access-detail-page"),null===n&&(n=r.querySelector("img.s-image"),null===n||(t=!0,n.parentNode.parentNode.parentNode.appendChild(e))))),t||(null===n?r.insertBefore(e,r.firstChild):n.parentNode.parentNode.appendChild(e))}if(we.bestsellers){const t=r.querySelector("a.a-link-normal > span > div");if(t){z(e,t.parentElement.parentElement)}else{const t=r.querySelector(".p13n-sc-uncoverable-faceout")?.querySelector("span");if(!t){s("Can't to find title element for add extension information");continue}z(e,t)}}h.amzDeals&&r.querySelector("#dealTitle").parentElement.appendChild(e)}Xe.addSearchButtons(e,y.title),Xe.addASIN(e,y),Xe.addBSR(e,y),Xe.addBuyBox(e,y),Xe.addPrime(e,y);const n=b.active||t<10;if(Xe.addTotalOffersAvailableQuantity(e,y,n),t++,Xe.addBrand(e,y),Xe.addProductInformation(e,y),Xe.addPriceData(e,y),!we.bestsellers){r.querySelector('.a-price[data-a-color="base"] .a-offscreen')||!y.minPrice&&!y.maxPrice||Xe.addPrice(e,y)}}}}})();